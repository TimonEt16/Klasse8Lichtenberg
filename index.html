=== FILE: package.json ===
{
  "name": "weekly-planner",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "framer-motion": "^10.12.5",
    "lucide-react": "^0.259.0",
    "next": "14.3.0",
    "react": "18.2.0",
    "react-dom": "18.2.0"
  },
  "devDependencies": {
    "autoprefixer": "^10.4.14",
    "postcss": "^8.4.24",
    "tailwindcss": "^4.4.3",
    "typescript": "^5.3.3"
  }
}
=== END FILE ===

=== FILE: tailwind.config.js ===
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    './src/**/*.{js,ts,jsx,tsx,mdx}',
    './app/**/*.{js,ts,jsx,tsx,mdx}',
    './pages/**/*.{js,ts,jsx,tsx}'
  ],
  darkMode: 'class',
  theme: {
    extend: {
      colors: {
        // Apple-like semantic palette
        accent: {
          DEFAULT: '#0ea5e9',
          50: '#f6fbff',
          100: '#e8f7ff'
        },
        neutral: {
          50: '#f8fafc',
          100: '#f1f5f9',
          300: '#cbd5e1',
          700: '#334155',
          900: '#0f172a'
        },
        sem: {
          school: '#60a5fa',    // blue-ish
          work: '#f97316',      // orange
          study: '#7c3aed',     // purple
          sport: '#10b981',     // green
          test: '#ef4444',      // red
          music: '#f59e0b',     // amber
          free: '#06b6d4'       // teal
        }
      },
      fontFamily: {
        sans: ['-apple-system', 'BlinkMacSystemFont', '"Segoe UI"', 'Roboto', 'Inter', 'ui-sans-serif', 'system-ui', 'sans-serif']
      },
      borderRadius: {
        lg2: '16px'
      },
      boxShadow: {
        'soft': '0 6px 18px rgba(15,23,42,0.06)',
        'soft-dark': '0 6px 18px rgba(2,6,23,0.6)'
      }
    }
  },
  plugins: []
};
=== END FILE ===

=== FILE: postcss.config.js ===
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
=== END FILE ===

=== FILE: src/styles/globals.css ===
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Global variables for Apple-like look */
:root {
  --card-bg: rgba(255,255,255,0.72);
  --card-bg-dark: rgba(15,23,42,0.56);
  --muted: #6b7280;
  --accent: #0ea5e9;
  --radius-lg: 14px;
}

/* Basic input/button utilities used in components */
.input {
  @apply px-3 py-2 rounded-lg border bg-white/80 dark:bg-slate-800/60 border-slate-200 dark:border-slate-700 focus:outline-none focus:ring-2 focus:ring-accent/20;
}
.btn-primary {
  @apply inline-flex items-center gap-2 bg-accent text-white px-3 py-2 rounded-lg shadow-soft hover:brightness-95 transition;
}
.btn-muted {
  @apply inline-flex items-center gap-2 bg-white/70 dark:bg-slate-800/60 px-3 py-2 rounded-lg border;
}
.icon-btn {
  @apply inline-flex items-center justify-center w-10 h-10 rounded-lg bg-white/70 dark:bg-slate-700/60 border;
}
.icon-mini {
  @apply inline-flex items-center justify-center w-8 h-8 rounded-md bg-white/30 border;
}
.stat-card {
  @apply p-3 rounded-lg bg-white/40 dark:bg-slate-800/40 border text-center;
}
.task-row {
  @apply p-3 rounded-xl border bg-white/40 dark:bg-slate-800/40;
}
.text-xxs { font-size: 11px; }

/* subtle hover for task rows (will be combined with Framer Motion) */
.task-row:hover { transform: translateY(-3px); }

/* category color chips */
.chip {
  @apply inline-flex items-center gap-2 px-2 py-1 rounded-full text-xs font-medium;
}
.chip-school { background-color: rgba(96,165,250,0.12); color: #2563EB; }
.chip-work { background-color: rgba(249,115,22,0.10); color: #C2410C; }
.chip-study { background-color: rgba(124,58,237,0.10); color: #5B21B6; }
.chip-sport { background-color: rgba(16,185,129,0.10); color: #059669; }
.chip-test { background-color: rgba(239,68,68,0.10); color: #DC2626; }
.chip-music { background-color: rgba(245,158,11,0.10); color: #B45309; }
.chip-free { background-color: rgba(6,182,212,0.10); color: #0891B2; }

body { font-family: theme('fontFamily.sans'); background: linear-gradient(180deg, #fbfdff 0%, #ffffff 100%); }

/* dark */
.dark body { background: linear-gradient(180deg, #071126 0%, #071226 100%); color: #e6eef8; }
=== END FILE ===

=== FILE: README.md ===
# Weekly Planner (Apple-style)

This repo contains a single Next.js page (`src/app/page.tsx`) implementing a weekly planner with:
- Drag & drop (safe)
- Recurring tasks merge
- Notifications
- ICS export
- Framer Motion hover/appear animations
- Semantic category colors (school, work, study, sport, test, music, free)
- Tailwind CSS theme tuned to an Apple-like look

## Quick start
1. `npm install`  
2. `npm run dev`  
3. Open `http://localhost:3000`

Make sure Tailwind is configured (provided `tailwind.config.js`) and PostCSS is present.

=== END FILE ===

=== FILE: src/app/page.tsx ===
/* Main page component - complete and ready to paste into src/app/page.tsx */
import React, { useCallback, useEffect, useLayoutEffect, useState } from 'react';
import { motion } from 'framer-motion';
import {
  Moon, Sun, Calendar, ChevronLeft, ChevronRight, Plus, Edit2, Trash2, X, Save, Check,
  Bell, AlertTriangle, Target, BookOpen, Download, Repeat, Clock
} from 'lucide-react';

/* -------------------------
  Types
--------------------------*/
type ID = number;
interface Task {
  id: ID;
  type: string;
  title: string;
  time?: string;
  recurring?: boolean;
  editable?: boolean;
  date?: string;
  studyDays?: number;
  notes?: string;
  notification?: boolean;
  isCustom?: boolean;
}
type Schedule = { [day: number]: Task[] };

/* -------------------------
  Constants & helpers
--------------------------*/
const days = ['Sonntag','Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag'];
const dayEmojis = ['☀️','🏫','🏫','🏫','🏫','🏫','🏋️‍♂️'];

const getWeekNumber = (date: Date) => {
  const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
  const dayNum = d.getUTCDay() || 7;
  d.setUTCDate(d.getUTCDate() + 4 - dayNum);
  const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
  return Math.ceil((((d.getTime() - yearStart.getTime()) / 86400000) + 1) / 7);
};

const getInitialSchedule = (): Schedule => ({
  0: [
    { id: 1, type: 'lesson', title: 'Novakid', time: '10:00 – 10:30', recurring: true, editable: true },
    { id: 2, type: 'study', title: 'Schulvorbereitung', time: '20:30 – 21:00', recurring: true, editable: true }
  ],
  1: [
    { id: 3, type: 'school', title: 'Schule', time: '08:00 – 15:15', recurring: true, editable: true },
    { id: 4, type: 'music', title: 'Musikunterricht', time: '15:30 – 16:30', recurring: true, editable: true },
    { id: 5, type: 'study', title: 'Schulvorbereitung', time: '20:30 – 21:00', recurring: true, editable: true }
  ],
  2: [
    { id: 6, type: 'school', title: 'Schule', time: '08:00 – 15:15', recurring: true, editable: true },
    { id: 7, type: 'work', title: 'Kaufland', time: '16:00 – 18:30', recurring: true, editable: true },
    { id: 8, type: 'study', title: 'Schulvorbereitung', time: '20:30 – 21:00', recurring: true, editable: true }
  ],
  3: [
    { id: 9, type: 'school', title: 'Schule', time: '08:00 – 13:10', recurring: true, editable: true },
    { id: 10, type: 'sport', title: 'Tischtennis', time: '17:00 – 18:30', recurring: true, editable: true },
    { id: 11, type: 'study', title: 'Schulvorbereitung', time: '20:30 – 21:00', recurring: true, editable: true }
  ],
  4: [
    { id: 12, type: 'school', title: 'Schule', time: '08:00 – 15:15', recurring: true, editable: true },
    { id: 13, type: 'work', title: 'Kaufland', time: '16:30 – 19:00', recurring: true, editable: true },
    { id: 14, type: 'study', title: 'Schulvorbereitung', time: '20:30 – 21:00', recurring: true, editable: true }
  ],
  5: [
    { id: 15, type: 'school', title: 'Schule', time: '08:00 – 13:10', recurring: true, editable: true },
    { id: 16, type: 'sport', title: 'Schwimmen', time: '16:30 – 17:15', recurring: true, editable: true },
    { id: 17, type: 'study', title: 'Schulnachbereitung', time: '20:30 – 21:00', recurring: true, editable: true }
  ],
  6: [
    { id: 18, type: 'sport', title: 'Gym', time: '08:30 – 10:00', recurring: true, editable: true },
    { id: 19, type: 'work', title: 'Kaufland', time: '10:30 – 13:30', recurring: true, editable: true }
  ]
});

const safeParse = (raw: string | null) => {
  if (!raw) return null;
  try { return JSON.parse(raw); } catch { return null; }
};

const isBaseTask = (task: Task, day: number) => {
  const base = getInitialSchedule()[day] || [];
  return base.some(b => b.title === task.title && b.type === task.type && b.time === task.time);
};

const getDateFromWeekdayIso = (weekday: number) => {
  const now = new Date();
  const diff = weekday - now.getDay();
  const target = new Date(now);
  target.setDate(now.getDate() + diff);
  target.setHours(0,0,0,0);
  return target.toISOString().split('T')[0];
};

const getTypeEmoji = (type: string) => {
  const map: Record<string,string> = {
    school: '🏫', work: '🛒', study: '🧠', sport: '🏊', music: '🎼', lesson: '📘',
    free: '🎯', sleep: '😴', test: '📝', appointment: '📅', hobby: '🎨'
  };
  return map[type] || '📋';
};

/* -------------------------
  Component
--------------------------*/
export default function WeeklyPlanner() {
  const [password, setPassword] = useState('');
  const [authenticated, setAuthenticated] = useState(false);
  const [currentDay, setCurrentDay] = useState<number>(new Date().getDay());
  const [schedule, setSchedule] = useState<Schedule>({});
  const [darkMode, setDarkMode] = useState(false);
  const [dragItem, setDragItem] = useState<{day:number,index:number}|null>(null);
  const [newTaskForm, setNewTaskForm] = useState<{show:boolean,day:number}>({show:false,day:0});
  const [editingItem, setEditingItem] = useState<ID|null>(null);
  const [showSuccess, setShowSuccess] = useState(false);
  const [showWeekView, setShowWeekView] = useState(false);
  const [filters, setFilters] = useState<{type:string}>({type:'all'});
  const [searchTerm, setSearchTerm] = useState('');
  const [notificationTime] = useState(6);

  /* Load schedule */
  const loadSchedule = useCallback((): Schedule => {
    const savedRaw = localStorage.getItem('weeklyPlannerSchedule');
    const lastWeekRaw = localStorage.getItem('currentWeekNumber');
    const now = new Date();
    const currentWeekNumber = getWeekNumber(now);

    const saved = safeParse(savedRaw);
    const lastWeek = safeParse(lastWeekRaw);

    if (!saved || !lastWeek || parseInt(String(lastWeek)) !== currentWeekNumber) {
      localStorage.setItem('currentWeekNumber', String(currentWeekNumber));
      const base = getInitialSchedule();
      if (saved) {
        // merge recurring user tasks
        const newSchedule: Schedule = { ...base };
        Object.keys(saved).forEach(k => {
          const day = parseInt(k);
          const tasks: Task[] = saved[day] || [];
          const recurring = tasks.filter(t => t.recurring && t.editable && (t.isCustom || !isBaseTask(t, day)));
          if (recurring.length) newSchedule[day] = [...(newSchedule[day]||[]), ...recurring.map(t=>({...t}))];
        });
        return newSchedule;
      }
      return base;
    }
    return saved || getInitialSchedule();
  }, []);

  useEffect(() => {
    const auth = localStorage.getItem('authenticated');
    if (auth === 'true') setAuthenticated(true);
    const savedDark = safeParse(localStorage.getItem('darkMode')||'false');
    if (savedDark !== null) setDarkMode(Boolean(savedDark));
    setSchedule(loadSchedule());
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  useEffect(() => {
    try { localStorage.setItem('weeklyPlannerSchedule', JSON.stringify(schedule)); } catch {}
  }, [schedule]);

  useEffect(() => { try { localStorage.setItem('darkMode', JSON.stringify(darkMode)); } catch {} }, [darkMode]);
  useLayoutEffect(() => { if (darkMode) document.documentElement.classList.add('dark'); else document.documentElement.classList.remove('dark'); }, [darkMode]);

  /* Notifications */
  useEffect(() => { if ('Notification' in window && Notification.permission === 'default') Notification.requestPermission().catch(()=>{}); }, []);

  useEffect(() => {
    const checkNotificationTime = () => {
      const now = new Date();
      const hours = now.getHours(), minutes = now.getMinutes();
      if (hours === notificationTime && minutes === 0) {
        // show daily toast (best-effort)
        if ('Notification' in window && Notification.permission === 'granted') {
          new Notification('🌅 Guten Morgen!', { body: `Heute ist ${days[new Date().getDay()]}` });
        }
      }
      if (minutes % 5 === 0) checkTaskReminders();
    };
    checkNotificationTime();
    const id = setInterval(checkNotificationTime, 60000);
    return () => clearInterval(id);
  }, [schedule, notificationTime]);

  const checkTaskReminders = useCallback(() => {
    if (Notification.permission !== 'granted') return;
    const now = new Date();
    const hhmm = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
    const todays = schedule[new Date().getDay()] || [];
    todays.forEach(task => {
      if (!task.notification || !task.time) return;
      let start = task.time.split('–')[0] || task.time.split('-')[0] || task.time;
      start = start.trim();
      if (start === hhmm) {
        new Notification(`${getTypeEmoji(task.type)} ${task.title}`, { body: task.time || '' });
      }
    });
  }, [schedule]);

  /* Drag & Drop */
  const handleDragStart = (day:number,index:number) => setDragItem({day,index});
  const handleDragOver = (e: React.DragEvent) => e.preventDefault();

  const handleDrop = (e: React.DragEvent, targetDay:number, targetIndex:number) => {
    e.preventDefault();
    if (!dragItem) return;
    const sourceDay = dragItem.day, sourceIndex = dragItem.index;
    if (!schedule[sourceDay] || sourceIndex >= schedule[sourceDay].length) { setDragItem(null); return; }
    if (sourceDay === targetDay && sourceIndex === targetIndex) { setDragItem(null); return; }

    setSchedule(prev => {
      const newSchedule: Schedule = {};
      Object.keys(prev).forEach(k => newSchedule[parseInt(k)] = prev[parseInt(k)].map(t => ({...t})));
      const movedTask = { ...newSchedule[sourceDay][sourceIndex] };
      newSchedule[sourceDay].splice(sourceIndex,1);
      if (!movedTask.isCustom && isBaseTask(movedTask, sourceDay)) { movedTask.isCustom = true; movedTask.recurring = false; }
      if (!newSchedule[targetDay]) newSchedule[targetDay] = [];
      if (targetIndex === -1 || targetIndex > newSchedule[targetDay].length) newSchedule[targetDay].push(movedTask);
      else newSchedule[targetDay].splice(targetIndex,0,movedTask);
      return newSchedule;
    });
    setDragItem(null);
    setShowSuccess(true); setTimeout(()=>setShowSuccess(false),2400);
  };

  /* Tasks CRUD */
  const addNewTask = useCallback((day:number, task: Partial<Task>) => {
    setSchedule(prev => {
      const flat = Object.values(prev).flat();
      const newId = flat.length ? Math.max(...flat.map(t=>t.id)) + 1 : 1;
      const newTask: Task = {
        id: newId,
        type: task.type || 'study',
        title: task.title || '',
        time: task.time || '',
        recurring: Boolean(task.recurring),
        editable: true,
        date: task.date || '',
        studyDays: task.type === 'test' ? (task.studyDays || 0) : 0,
        notes: task.notes || '',
        notification: Boolean(task.notification),
        isCustom: true
      };
      const next = { ...prev, [day]: [...(prev[day]||[]), newTask] };
      return next;
    });
    setShowSuccess(true); setTimeout(()=>setShowSuccess(false),2400);
  }, []);

  const updateTask = useCallback((dayIndex:number, taskId:ID, updates:Partial<Task>) => {
    setSchedule(prev => {
      const next = { ...prev };
      next[dayIndex] = (next[dayIndex]||[]).map(t => t.id === taskId ? { ...t, ...updates, isCustom: true } : t);
      return next;
    });
    setShowSuccess(true); setTimeout(()=>setShowSuccess(false),2400);
  }, []);

  const deleteTask = useCallback((dayIndex:number, taskId:ID) => {
    setSchedule(prev => {
      const next = { ...prev };
      next[dayIndex] = (next[dayIndex]||[]).filter(t => t.id !== taskId);
      return next;
    });
    setShowSuccess(true); setTimeout(()=>setShowSuccess(false),2400);
  }, []);

  /* Filters / helpers */
  const getTasksForDay = useCallback((day:number)=> schedule[day] || [], [schedule]);
  const getFilteredTasks = useCallback((tasks:Task[]) => {
    return tasks.filter(task => {
      const matchesType = filters.type === 'all' || task.type === filters.type;
      const matchesSearch = searchTerm.trim() === '' || task.title.toLowerCase().includes(searchTerm.toLowerCase()) || (task.time && task.time.toLowerCase().includes(searchTerm.toLowerCase()));
      return matchesType && matchesSearch;
    });
  }, [filters.type, searchTerm]);

  /* Stats & upcoming tests */
  const getUpcomingTests = useCallback(() => {
    const tests: Array<Task & { day:number; dayName:string; daysUntil:number }> = [];
    Object.entries(schedule).forEach(([dayStr, tasks]) => {
      tasks.forEach(task => {
        if (task.type === 'test' && task.date) {
          const testDate = new Date(task.date); testDate.setHours(0,0,0,0);
          const today = new Date(); today.setHours(0,0,0,0);
          const daysUntil = Math.ceil((testDate.getTime() - today.getTime())/(1000*60*60*24));
          if (daysUntil >= 0) tests.push({...task, day: parseInt(dayStr), dayName: days[parseInt(dayStr)], daysUntil});
        }
      });
    });
    return tests.sort((a,b)=>a.daysUntil-b.daysUntil);
  }, [schedule]);

  const calculateWeeklyStats = useCallback(() => {
    const flat = Object.values(schedule).flat();
    const workHours = flat.filter(t=>t.type==='work').reduce((acc,t)=>{
      const time = t.time || '';
      if (time.includes('16:00') && time.includes('18:30')) return acc + 2.5;
      if (time.includes('16:30') && time.includes('19:00')) return acc + 2.5;
      if (time.includes('10:30') && time.includes('13:30')) return acc + 3;
      return acc;
    },0);
    return { workHours, studyTasks: flat.filter(t=>t.type==='study').length, sportTasks: flat.filter(t=>t.type==='sport').length, upcomingTests: getUpcomingTests().length };
  }, [schedule, getUpcomingTests]);

  const exportToCalendar = () => {
    const ical = ['BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//Weekly Planner//DE','CALSCALE:GREGORIAN'];
    Object.entries(schedule).forEach(([dayIndexStr,tasks])=>{
      const dayIndex = parseInt(dayIndexStr);
      tasks.forEach(task=>{
        const dateIso = task.date ? task.date : getDateFromWeekdayIso(dayIndex);
        if (!task.time) return;
        const parts = task.time.split('–').map(s=>s.trim());
        if (parts.length < 2) return;
        const start = parts[0].replace(':',''), end = parts[1].replace(':','');
        ical.push('BEGIN:VEVENT');
        ical.push(`SUMMARY:${(task.title||'')}`);
        ical.push(`DESCRIPTION:${(task.notes||'')}`);
        ical.push(`DTSTART:${dateIso.replace(/-/g,'')}T${start}00`);
        ical.push(`DTEND:${dateIso.replace(/-/g,'')}T${end}00`);
        ical.push('END:VEVENT');
      });
    });
    ical.push('END:VCALENDAR');
    const blob = new Blob([ical.join('\n')], { type: 'text/calendar' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'wochenplan.ics'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    setShowSuccess(true); setTimeout(()=>setShowSuccess(false),2400);
  };

  const upcomingTests = getUpcomingTests();
  const weeklyStats = calculateWeeklyStats();

  /* ---- TaskForm subcomponent ---- */
  function TaskForm({ task, onSave, onCancel }: { task?: Partial<Task>, onSave: (d:Partial<Task>)=>void, onCancel: ()=>void }) {
    const [form, setForm] = useState({
      title: task?.title || '',
      time: task?.time || '',
      type: task?.type || 'study',
      date: task?.date || '',
      studyDays: task?.studyDays || 0,
      notes: task?.notes || '',
      recurring: task?.recurring || false,
      notification: task?.notification || false
    });

    return (
      <div className="p-4 rounded-xl border bg-white/60 dark:bg-slate-800/60 shadow-sm">
        <div className="grid gap-3">
          <select value={form.type} onChange={e=>setForm({...form,type:e.target.value})} className="input">
            <option value="study">🧠 Lernen</option>
            <option value="test">📝 Test/Klausur</option>
            <option value="work">🛒 Arbeit</option>
            <option value="sport">🏊 Sport</option>
            <option value="music">🎼 Musik</option>
            <option value="lesson">📘 Unterricht</option>
            <option value="free">🎯 Freizeit</option>
            <option value="school">🏫 Schule</option>
            <option value="appointment">📅 Termin</option>
            <option value="hobby">🎨 Hobby</option>
          </select>
          <input className="input" value={form.title} onChange={e=>setForm({...form,title:e.target.value})} placeholder="Aufgabe/Termin" />
          <input className="input" value={form.time} onChange={e=>setForm({...form,time:e.target.value})} placeholder="Zeit (z.B. 14:00 – 15:30)" />
          <textarea className="input h-20" value={form.notes} onChange={e=>setForm({...form,notes:e.target.value})} placeholder="Notizen (optional)"></textarea>
          {form.type==='test' && <>
            <input className="input" type="date" value={form.date} onChange={e=>setForm({...form,date:e.target.value})} />
            <div className="flex items-center gap-3">
              <label className="text-sm">Lerntage vorher:</label>
              <input className="input w-20" type="number" min={0} max={21} value={form.studyDays} onChange={e=>setForm({...form,studyDays:parseInt(e.target.value||'0')})} />
            </div>
          </>}
          <div className="flex gap-4 items-center">
            <label className="flex items-center gap-2"><input type="checkbox" checked={form.recurring} onChange={e=>setForm({...form,recurring:e.target.checked})} /> <span className="text-sm">Wöchentlich wiederkehrend</span></label>
            <label className="flex items-center gap-2"><input type="checkbox" checked={form.notification} onChange={e=>setForm({...form,notification:e.target.checked})} /> <span className="text-sm">Erinnerung</span></label>
          </div>
          <div className="flex gap-3">
            <motion.button whileHover={{ scale: 1.03 }} className="btn-primary" onClick={()=>onSave(form)} disabled={!form.title.trim()}>
              <Save className="w-4 h-4" /> Speichern
            </motion.button>
            <motion.button whileHover={{ scale: 1.03 }} className="btn-muted" onClick={onCancel}><X className="w-4 h-4" /> Abbrechen</motion.button>
          </div>
        </div>
      </div>
    );
  }

  /* -------------------------
    Render
  --------------------------*/
  if (!authenticated) {
    return (
      <div className="min-h-screen flex items-center justify-center p-6">
        <motion.div initial={{opacity:0, y:10}} animate={{opacity:1, y:0}} className="w-full max-w-md bg-white/80 dark:bg-slate-800/80 backdrop-blur rounded-2xl p-8 border">
          <h1 className="text-2xl font-semibold mb-6">🔒 Wochenplaner Login</h1>
          <form onSubmit={(e)=>{ e.preventDefault(); if (password==='Timon1605') { setAuthenticated(true); localStorage.setItem('authenticated','true'); } else { alert('Falsches Passwort'); } }}>
            <label className="block text-sm mb-2">Passwort</label>
            <input className="input w-full mb-4" value={password} onChange={e=>setPassword(e.target.value)} type="password" placeholder="Passwort eingeben" />
            <motion.button whileHover={{ scale: 1.02 }} className="btn-primary w-full" type="submit">Anmelden</motion.button>
          </form>
        </motion.div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-b from-slate-50 to-white dark:from-slate-900 dark:to-slate-800 p-6">
      <div className="max-w-6xl mx-auto">
        <header className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-semibold">📅 Mein Wochenplaner</h1>
            <p className="text-sm text-slate-500">Apple-like — klar & minimal</p>
          </div>
          <div className="flex items-center gap-3">
            <motion.button whileHover={{ scale: 1.02 }} className="icon-btn" onClick={()=>setDarkMode(d=>!d)}>{ darkMode ? <Sun/> : <Moon/> }</motion.button>
            <motion.button whileHover={{ scale: 1.02 }} className="icon-btn" onClick={exportToCalendar}><Download/></motion.button>
            <motion.button whileHover={{ scale: 1.02 }} className="btn-muted px-4 py-2" onClick={()=>setShowWeekView(v=>!v)}>{ showWeekView ? 'Tagesansicht' : 'Wochenansicht' }</motion.button>
          </div>
        </header>

        <section className="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6">
          <div className="col-span-2 bg-white/60 dark:bg-slate-800/60 p-4 rounded-2xl border">
            <div className="grid grid-cols-4 gap-3 mb-4">
              <div className="stat-card"><div className="text-lg font-semibold">{weeklyStats.workHours}h</div><div className="text-xs text-slate-500">Arbeitszeit</div></div>
              <div className="stat-card"><div className="text-lg font-semibold">{weeklyStats.studyTasks}</div><div className="text-xs text-slate-500">Lernaufgaben</div></div>
              <div className="stat-card"><div className="text-lg font-semibold">{weeklyStats.sportTasks}</div><div className="text-xs text-slate-500">Sport</div></div>
              <div className="stat-card"><div className="text-lg font-semibold">{weeklyStats.upcomingTests}</div><div className="text-xs text-slate-500">Anstehende Tests</div></div>
            </div>

            {showSuccess && <motion.div initial={{opacity:0}} animate={{opacity:1}} className="p-3 rounded-lg bg-emerald-50 border border-emerald-200 text-emerald-800 mb-4 flex items-center gap-3"><Check/> Änderungen gespeichert</motion.div>}

            {upcomingTests.length>0 && <div className="p-3 rounded-lg bg-yellow-50 border border-yellow-100 mb-4">
              <div className="flex items-start gap-3"><AlertTriangle className="w-5 h-5 text-yellow-600"/><div><div className="font-semibold">📝 Anstehende Tests</div><div className="text-sm text-slate-600">{ upcomingTests.slice(0,3).map(t=> <div key={t.id}>{t.title} — {t.dayName} {t.daysUntil===0? '(Heute)' : t.daysUntil===1? '(Morgen)' : `(in ${t.daysUntil} Tagen)`}</div>) }</div></div></div>
            </div>}

            {!showWeekView ? (
              <>
                <div className="flex items-center gap-2 overflow-x-auto mb-4">
                  <motion.button whileHover={{scale:1.02}} className="icon-btn" onClick={()=>setCurrentDay(d=>d===0?6:d-1)}><ChevronLeft/></motion.button>
                  {days.map((d,i)=>(
                    <motion.button key={i} whileHover={{scale:1.02}} onClick={()=>setCurrentDay(i)} className={`flex-1 min-w-[90px] px-2 py-2 mx-1 rounded-xl text-sm font-medium transition-all ${currentDay===i? 'bg-accent text-white shadow-soft transform scale-105' : 'bg-white/60 dark:bg-slate-800/60 border'}`}>
                      <div className="text-xl mb-1">{dayEmojis[i]}</div>
                      <div className="truncate">{d}</div>
                      <div className="text-xs text-slate-400">{getTasksForDay(i).length} Aufgaben</div>
                    </motion.button>
                  ))}
                  <motion.button whileHover={{scale:1.02}} className="icon-btn" onClick={()=>setCurrentDay(d=>d===6?0:d+1)}><ChevronRight/></motion.button>
                </div>

                <div className="flex gap-3 items-center mb-4">
                  <input className="input flex-1" placeholder="Aufgaben suchen..." value={searchTerm} onChange={e=>setSearchTerm(e.target.value)} />
                  <select className="input w-44" value={filters.type} onChange={e=>setFilters({type:e.target.value})}>
                    <option value="all">Alle Typen</option>
                    <option value="school">Schule</option>
                    <option value="work">Arbeit</option>
                    <option value="study">Lernen</option>
                    <option value="sport">Sport</option>
                    <option value="test">Tests</option>
                  </select>
                </div>

                <div className="bg-white/40 dark:bg-slate-800/40 p-4 rounded-2xl border">
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-lg font-semibold">{dayEmojis[currentDay]} {days[currentDay]}</h2>
                    <div><motion.button whileHover={{scale:1.03}} className="btn-primary" onClick={()=>setNewTaskForm({show:true,day:currentDay})}><Plus/> Aufgabe</motion.button></div>
                  </div>

                  {newTaskForm.show && newTaskForm.day===currentDay && <div className="mb-4"><TaskForm task={{}} onSave={(d)=>{ addNewTask(currentDay,d); setNewTaskForm({show:false,day:0}); }} onCancel={()=>setNewTaskForm({show:false,day:0})} /></div>}

                  <div className="space-y-3">
                    { getFilteredTasks(getTasksForDay(currentDay)).length>0 ? getFilteredTasks(getTasksForDay(currentDay)).map((task,idx)=>(
                      <motion.div initial={{opacity:0, y:6}} animate={{opacity:1,y:0}} whileHover={{y:-4}} key={task.id} draggable={task.editable} onDragStart={()=>handleDragStart(currentDay, idx)} onDragOver={handleDragOver} onDrop={(e)=>handleDrop(e, currentDay, idx)} className="task-row">
                        <div className="flex items-start gap-3 w-full">
                          <div className="text-2xl">{getTypeEmoji(task.type)}</div>
                          <div className="flex-1">
                            <div className="flex justify-between">
                              <div>
                                <div className="font-medium">{task.title} {task.recurring && <span className="text-xs px-2 py-1 rounded-full bg-white/20 text-slate-600 ml-2"><Repeat className="inline-block w-3 h-3 mr-1"/>wöchentlich</span>}</div>
                                <div className="text-xs text-slate-500">{task.notes}</div>
                                {task.type==='test' && task.date && <div className="text-xxs mt-1 text-slate-500">📅 {new Date(task.date).toLocaleDateString('de-DE')}</div>}
                              </div>
                              <div className="text-right">
                                {task.time && <div className="text-sm"><Clock className="inline mr-1"/> {task.time}</div>}
                                <div className="flex gap-2 mt-2">
                                  <motion.button whileHover={{scale:1.06}} onClick={()=>setEditingItem(task.id)} className="icon-mini"><Edit2/></motion.button>
                                  <motion.button whileHover={{scale:1.06}} onClick={()=>deleteTask(currentDay, task.id)} className="icon-mini destructive"><Trash2/></motion.button>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        { editingItem === task.id && <div className="mt-3"><TaskForm task={task} onSave={(upd)=>{ updateTask(currentDay, task.id, upd); setEditingItem(null); }} onCancel={()=>setEditingItem(null)} /></div> }
                      </motion.div>
                    )) : (
                      <div className="text-center py-8 text-slate-400">
                        <Target className="mx-auto mb-3" /> Keine Aufgaben — füge eine neue hinzu.
                      </div>
                    )}
                  </div>

                  <div onDragOver={handleDragOver} onDrop={(e)=>{ e.preventDefault(); if (dragItem) handleDrop(e, currentDay, -1); }} className="mt-4 p-4 border-dashed border rounded-lg text-center text-slate-400">Aufgabe hier ablegen, um ans Ende zu verschieben</div>
                </div>
              </>
            ) : (
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                {days.map((d,di)=>(
                  <div key={di} className="bg-white/40 dark:bg-slate-800/40 p-3 rounded-xl border" onDragOver={handleDragOver} onDrop={(e)=>{ e.preventDefault(); if (dragItem) handleDrop(e, di, -1); }}>
                    <div className="flex items-center justify-between mb-3"><div className="font-semibold">{d}</div><div className="text-xs text-slate-400">({getTasksForDay(di).length})</div></div>
                    <div className="space-y-2">{ getTasksForDay(di).slice(0,6).map((t, idx)=>(
                      <motion.div key={t.id} draggable={t.editable} onDragStart={()=>handleDragStart(di, idx)} onDragOver={handleDragOver} onDrop={(e)=>handleDrop(e, di, idx)} className="p-2 rounded-md border">
                        <div className="flex justify-between items-center"><div className="flex items-center gap-2"><div className="text-sm">{getTypeEmoji(t.type)}</div><div className="text-sm truncate">{t.title}</div></div><div className="text-xxs text-slate-400">{t.time}</div></div>
                      </motion.div>
                    )) } { getTasksForDay(di).length === 0 && <div className="text-xs italic text-slate-400">Keine Aufgaben</div> }</div>
                    <button className="mt-3 btn-muted w-full" onClick={()=>{ setCurrentDay(di); setShowWeekView(false); }}>Zu {d}</button>
                  </div>
                ))}
              </div>
            )}
          </div>

          <aside className="bg-white/60 dark:bg-slate-800/60 p-4 rounded-2xl border">
            <div className="mb-4">
              <div className="flex items-center justify-between">
                <h3 className="font-semibold">Heute</h3>
                <button className="icon-btn"><Bell/></button>
              </div>
              <div className="mt-3 space-y-2">
                { getTasksForDay(new Date().getDay()).slice(0,6).map(t=>(
                  <div key={t.id} className="flex items-center justify-between"><div className="flex items-center gap-2"><div>{getTypeEmoji(t.type)}</div><div className="text-sm">{t.title}</div></div><div className="text-xs text-slate-400">{t.time}</div></div>
                )) }
              </div>
            </div>

            <div>
              <h4 className="font-semibold mb-2">Kaufland Übersicht</h4>
              <div className="space-y-2">
                { getTasksForDay(2).filter(t=>t.type==='work').map(t=>(<div key={t.id} className="p-2 rounded-md border"><div className="text-sm">{t.time}</div><div className="text-xxs text-slate-500">Dienstag</div></div>)) }
                { getTasksForDay(4).filter(t=>t.type==='work').map(t=>(<div key={t.id} className="p-2 rounded-md border"><div className="text-sm">{t.time}</div><div className="text-xxs text-slate-500">Donnerstag</div></div>)) }
                { getTasksForDay(6).filter(t=>t.type==='work').map(t=>(<div key={t.id} className="p-2 rounded-md border"><div className="text-sm">{t.time}</div><div className="text-xxs text-slate-500">Samstag</div></div>)) }
              </div>
              <div className="mt-3 text-center font-semibold p-2 rounded-md bg-sky-500 text-white">Gesamt: 8h / Woche</div>
            </div>
          </aside>
        </section>
      </div>
    </div>
  );
}
=== END FILE ===
