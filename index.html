<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gruppen-Verwaltung</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #4facfe;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .group-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .member-input {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .name-input {
            flex: 1;
            min-width: 200px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .name-input:focus {
            outline: none;
            border-color: #4facfe;
        }

        .file-input {
            display: none;
        }

        .file-label {
            background: #6c757d;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 0.9rem;
        }

        .file-label:hover {
            background: #5a6268;
        }

        .signature-preview {
            max-width: 150px;
            max-height: 60px;
            border-radius: 5px;
            border: 2px solid #e0e0e0;
            margin-left: 10px;
        }

        .remove-member {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .remove-member:hover {
            background: #c82333;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 172, 254, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .groups-display {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .group-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 4px solid #4facfe;
            transition: transform 0.3s;
        }

        .group-card:hover {
            transform: translateY(-3px);
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .group-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }

        .member-card {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .member-name {
            font-weight: 600;
            color: #495057;
        }

        .member-signature {
            max-width: 120px;
            max-height: 50px;
            border-radius: 4px;
        }

        .classes-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .class-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-top: 5px solid;
        }

        .class-a { border-top-color: #ff6b6b; }
        .class-b { border-top-color: #4ecdc4; }
        .class-c { border-top-color: #45b7d1; }

        .class-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .class-name {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .class-count {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .alert {
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .edit-form {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
        }

        .edit-member-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .edit-name-input {
            flex: 1;
            min-width: 200px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.95rem;
        }

        .edit-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn-edit {
            background: #ffc107;
            color: #212529;
            font-size: 0.9rem;
            padding: 8px 15px;
        }

        .btn-edit:hover {
            background: #e0a800;
        }

        .btn-save-edit {
            background: #28a745;
            color: white;
            font-size: 0.9rem;
        }

        .btn-cancel-edit {
            background: #6c757d;
            color: white;
            font-size: 0.9rem;
        }
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .content {
                padding: 20px;
            }

            .member-input {
                flex-direction: column;
                align-items: stretch;
            }

            .name-input {
                min-width: unset;
            }

            .form-actions {
                flex-direction: column;
            }

            .classes-display {
                grid-template-columns: 1fr;
            }

            .stats {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Gruppen-Verwaltung</h1>
            <p>Erstellen, verwalten und in Klassen aufteilen</p>
        </div>

        <div class="content">
            <!-- Statistiken -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalGroups">0</div>
                    <div class="stat-label">Gespeicherte Gruppen</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalMembers">0</div>
                    <div class="stat-label">Gesamtmitglieder</div>
                </div>
            </div>

            <!-- Meldungen -->
            <div id="messageArea"></div>

            <!-- Gruppe erstellen -->
            <div class="section">
                <h2>üìù Neue Gruppe erstellen</h2>
                <div class="group-form">
                    <div id="membersContainer">
                        <div class="member-input">
                            <input type="text" class="name-input" placeholder="Vollst√§ndiger Name des Mitglieds" required>
                            <input type="file" class="file-input" accept=".png,.jpg,.jpeg" id="file-0">
                            <label for="file-0" class="file-label">üìé Unterschrift w√§hlen</label>
                            <button type="button" class="remove-member" onclick="removeMember(this)" style="display: none;">‚ùå</button>
                        </div>
                        <div class="member-input">
                            <input type="text" class="name-input" placeholder="Vollst√§ndiger Name des Mitglieds" required>
                            <input type="file" class="file-input" accept=".png,.jpg,.jpeg" id="file-1">
                            <label for="file-1" class="file-label">üìé Unterschrift w√§hlen</label>
                            <button type="button" class="remove-member" onclick="removeMember(this)" style="display: none;">‚ùå</button>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="addMember()">‚ûï Mitglied hinzuf√ºgen</button>
                        <button type="button" class="btn btn-primary" onclick="saveGroup()">üíæ Gruppe speichern</button>
                        <button type="button" class="btn btn-danger" onclick="clearForm()">üóëÔ∏è Formular leeren</button>
                    </div>
                </div>
            </div>

            <!-- Gespeicherte Gruppen -->
            <div class="section">
                <h2>üë• Gespeicherte Gruppen</h2>
                <div class="form-actions">
                    <button type="button" class="btn btn-success" onclick="createClasses()">üé≤ Klassen automatisch erstellen</button>
                    <button type="button" class="btn btn-danger" onclick="deleteAllGroups()">üóëÔ∏è Alle Gruppen l√∂schen</button>
                </div>
                <div id="groupsDisplay" class="groups-display"></div>
            </div>

            <!-- Klassen -->
            <div class="section" id="classesSection" style="display: none;">
                <h2>üè´ Klasseneinteilung</h2>
                <div id="classesDisplay" class="classes-display"></div>
            </div>
        </div>
    </div>

    <script>
        let groups = [];
        let memberCounter = 2;
        let groupCounter = 30; // Start bei 30, da bereits 29 Gruppen vorhanden

        // Beim Laden der Seite gespeicherte Gruppen laden
        window.onload = function() {
            loadGroups();
            updateStats();
            displayGroups();
        };

        // Vorgefertigte Gruppen laden
        function loadPredefinedGroups() {
            const predefinedGroups = [
                {
                    id: 1,
                    name: "Gruppe 1",
                    members: [
                        { name: "Robinson Kaleo Klene", signature: null },
                        { name: "Johannes Gerhardt", signature: null },
                        { name: "Simon Habedank", signature: null }
                    ]
                },
                {
                    id: 2,
                    name: "Gruppe 2",
                    members: [
                        { name: "Tabea Michaelsen", signature: null },
                        { name: "Lovis Nieweler", signature: null },
                        { name: "Wiebke Schmidt", signature: null }
                    ]
                },
                {
                    id: 3,
                    name: "Gruppe 3",
                    members: [
                        { name: "Theresa Heine", signature: null },
                        { name: "Pia Setzer", signature: null },
                        { name: "Liselotte Arnold", signature: null }
                    ]
                },
                {
                    id: 4,
                    name: "Gruppe 4",
                    members: [
                        { name: "Edgar Schwer", signature: null },
                        { name: "Moritz Schmidt", signature: null },
                        { name: "Fynn Frahm", signature: null }
                    ]
                },
                {
                    id: 5,
                    name: "Gruppe 5",
                    members: [
                        { name: "Isabel Petrick", signature: null }
                    ]
                },
                {
                    id: 6,
                    name: "Gruppe 6",
                    members: [
                        { name: "Wolodymyr Soloshenko", signature: null },
                        { name: "Samuel Berg", signature: null },
                        { name: "Pablo B√§r", signature: null }
                    ]
                },
                {
                    id: 7,
                    name: "Gruppe 7",
                    members: [
                        { name: "Bruno Sanchez Gutsche", signature: null },
                        { name: "Timon Eternach", signature: null },
                        { name: "Oskar M√ºller", signature: null }
                    ]
                },
                {
                    id: 8,
                    name: "Gruppe 8",
                    members: [
                        { name: "Nikita Frey", signature: null },
                        { name: "Naima Deckelmann", signature: null }
                    ]
                },
                {
                    id: 9,
                    name: "Gruppe 9",
                    members: [
                        { name: "Guantsa Shakulashvili", signature: null },
                        { name: "Hanen Sallat", signature: null }
                    ]
                },
                {
                    id: 10,
                    name: "Gruppe 10",
                    members: [
                        { name: "Katerina Korosteleva", signature: null },
                        { name: "Alrike Janowski", signature: null }
                    ]
                },
                {
                    id: 11,
                    name: "Gruppe 11",
                    members: [
                        { name: "Finn Riedel", signature: null },
                        { name: "Theo Gr√∂ger", signature: null }
                    ]
                },
                {
                    id: 12,
                    name: "Gruppe 12",
                    members: [
                        { name: "Marko Sejdi", signature: null },
                        { name: "Henry Fischer", signature: null }
                    ]
                },
                {
                    id: 13,
                    name: "Gruppe 13",
                    members: [
                        { name: "Monique Neumeister", signature: null },
                        { name: "Maya Schaller", signature: null },
                        { name: "Maidi Dieke", signature: null }
                    ]
                },
                {
                    id: 14,
                    name: "Gruppe 14",
                    members: [
                        { name: "Khaled Alabdullah", signature: null }
                    ]
                },
                {
                    id: 15,
                    name: "Gruppe 15",
                    members: [
                        { name: "Alexander Noel Pretsch", signature: null },
                        { name: "Neven Bayer", signature: null }
                    ]
                },
                {
                    id: 16,
                    name: "Gruppe 16",
                    members: [
                        { name: "Esma Nur Aksakal", signature: null },
                        { name: "Serafina Lison", signature: null },
                        { name: "Mariia Kleshchenko", signature: null }
                    ]
                },
                {
                    id: 17,
                    name: "Gruppe 17",
                    members: [
                        { name: "Georg Stammer", signature: null },
                        { name: "Antoni Otto Petzold", signature: null }
                    ]
                },
                {
                    id: 18,
                    name: "Gruppe 18",
                    members: [
                        { name: "Raphael Riedel", signature: null },
                        { name: "Vincent Peter Pitzke", signature: null }
                    ]
                },
                {
                    id: 19,
                    name: "Gruppe 19",
                    members: [
                        { name: "Marie Luise Rosenkranz", signature: null },
                        { name: "Elisabeth Lantermann", signature: null }
                    ]
                },
                {
                    id: 20,
                    name: "Gruppe 20",
                    members: [
                        { name: "Henriette Nowak", signature: null },
                        { name: "Lena Carola Matthes", signature: null },
                        { name: "Leonie Fee Schwarze", signature: null }
                    ]
                },
                {
                    id: 21,
                    name: "Gruppe 21",
                    members: [
                        { name: "Paul Blum", signature: null },
                        { name: "Alfred Karl Adamitz", signature: null }
                    ]
                },
                {
                    id: 22,
                    name: "Gruppe 22",
                    members: [
                        { name: "Vincent Gutjahr", signature: null },
                        { name: "Neo Joel Vogt", signature: null }
                    ]
                },
                {
                    id: 23,
                    name: "Gruppe 23",
                    members: [
                        { name: "Ida Johnsen", signature: null },
                        { name: "Gaia Burnett", signature: null },
                        { name: "Alma Knauer", signature: null }
                    ]
                },
                {
                    id: 24,
                    name: "Gruppe 24",
                    members: [
                        { name: "Emelie Steinbruckner", signature: null },
                        { name: "Marla Hummitzsch", signature: null }
                    ]
                },
                {
                    id: 25,
                    name: "Gruppe 25",
                    members: [
                        { name: "David Hippner", signature: null },
                        { name: "Vladyslav Bespvhn", signature: null },
                        { name: "Lelio Sebashani", signature: null }
                    ]
                },
                {
                    id: 26,
                    name: "Gruppe 26",
                    members: [
                        { name: "Michael Kokorin", signature: null },
                        { name: "Abrar Allcurdi", signature: null },
                        { name: "Emil Schleier", signature: null }
                    ]
                },
                {
                    id: 27,
                    name: "Gruppe 27",
                    members: [
                        { name: "Mateusz Bruno Gaworek", signature: null },
                        { name: "Selina Herkner", signature: null },
                        { name: "Fridjof Fischer", signature: null }
                    ]
                },
                {
                    id: 28,
                    name: "Gruppe 28",
                    members: [
                        { name: "Ansgar Richard Oliver Venediger", signature: null },
                        { name: "Quentin Kirbach", signature: null },
                        { name: "Finn Joel Beyer", signature: null }
                    ]
                },
                {
                    id: 29,
                    name: "Gruppe 29",
                    members: [
                        { name: "Julia Mocha", signature: null },
                        { name: "Alexandra Marie Seiser", signature: null }
                    ]
                }
            ];

            return predefinedGroups;
        }

        // Gruppen aus JavaScript-Variable laden (ersetzt localStorage)
        function loadGroups() {
            // Vorgefertigte Gruppen laden
            groups = loadPredefinedGroups();
        }

        // Gruppen in JavaScript-Variable speichern
        function saveGroups() {
            // Speicherung erfolgt automatisch in der groups-Variable
            updateStats();
        }

        function addMember() {
            const container = document.getElementById('membersContainer');
            const memberInputs = container.querySelectorAll('.member-input');
            
            if (memberInputs.length >= 3) {
                showMessage('Maximal 3 Mitglieder pro Gruppe erlaubt!', 'error');
                return;
            }

            const memberDiv = document.createElement('div');
            memberDiv.className = 'member-input';
            
            memberDiv.innerHTML = `
                <input type="text" class="name-input" placeholder="Vollst√§ndiger Name des Mitglieds" required>
                <input type="file" class="file-input" accept=".png,.jpg,.jpeg" id="file-${memberCounter}">
                <label for="file-${memberCounter}" class="file-label">üìé Unterschrift w√§hlen</label>
                <button type="button" class="remove-member" onclick="removeMember(this)">‚ùå</button>
            `;
            
            container.appendChild(memberDiv);
            
            // Event Listener f√ºr Datei-Upload hinzuf√ºgen
            const fileInput = memberDiv.querySelector('.file-input');
            fileInput.addEventListener('change', handleFileUpload);
            
            memberCounter++;
            updateRemoveButtons();
        }

        function removeMember(button) {
            const memberInput = button.parentElement;
            memberInput.remove();
            updateRemoveButtons();
        }

        function updateRemoveButtons() {
            const container = document.getElementById('membersContainer');
            const memberInputs = container.querySelectorAll('.member-input');
            const removeButtons = container.querySelectorAll('.remove-member');
            
            removeButtons.forEach((button, index) => {
                if (memberInputs.length <= 2) {
                    button.style.display = 'none';
                } else {
                    button.style.display = 'inline-block';
                }
            });
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            const memberInput = event.target.parentElement;
            
            // Vorherige Vorschau entfernen
            const existingPreview = memberInput.querySelector('.signature-preview');
            if (existingPreview) {
                existingPreview.remove();
            }
            
            if (file) {
                // Dateigr√∂√üe pr√ºfen (max 2MB)
                if (file.size > 2 * 1024 * 1024) {
                    showMessage('Datei zu gro√ü! Maximal 2MB erlaubt.', 'error');
                    event.target.value = '';
                    return;
                }
                
                // Bildvorschau erstellen
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'signature-preview';
                    img.alt = 'Unterschrift Vorschau';
                    memberInput.appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        }

        function saveGroup() {
            const container = document.getElementById('membersContainer');
            const memberInputs = container.querySelectorAll('.member-input');
            
            if (memberInputs.length < 2) {
                showMessage('Mindestens 2 Mitglieder erforderlich!', 'error');
                return;
            }
            
            const members = [];
            let hasEmptyName = false;
            
            memberInputs.forEach((memberDiv, index) => {
                const nameInput = memberDiv.querySelector('.name-input');
                const fileInput = memberDiv.querySelector('.file-input');
                
                if (!nameInput.value.trim()) {
                    hasEmptyName = true;
                    return;
                }
                
                const member = {
                    name: nameInput.value.trim(),
                    signature: null
                };
                
                if (fileInput.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        member.signature = e.target.result;
                    };
                    reader.readAsDataURL(fileInput.files[0]);
                }
                
                members.push(member);
            });
            
            if (hasEmptyName) {
                showMessage('Alle Mitglieder m√ºssen einen Namen haben!', 'error');
                return;
            }
            
            const group = {
                id: Date.now(),
                name: `Gruppe ${groupCounter}`,
                members: members
            };
            
            groups.push(group);
            groupCounter++;
            
            showMessage(`${group.name} erfolgreich gespeichert!`, 'success');
            clearForm();
            saveGroups();
            displayGroups();
        }

        function clearForm() {
            const container = document.getElementById('membersContainer');
            container.innerHTML = `
                <div class="member-input">
                    <input type="text" class="name-input" placeholder="Vollst√§ndiger Name des Mitglieds" required>
                    <input type="file" class="file-input" accept=".png,.jpg,.jpeg" id="file-0">
                    <label for="file-0" class="file-label">üìé Unterschrift w√§hlen</label>
                    <button type="button" class="remove-member" onclick="removeMember(this)" style="display: none;">‚ùå</button>
                </div>
                <div class="member-input">
                    <input type="text" class="name-input" placeholder="Vollst√§ndiger Name des Mitglieds" required>
                    <input type="file" class="file-input" accept=".png,.jpg,.jpeg" id="file-1">
                    <label for="file-1" class="file-label">üìé Unterschrift w√§hlen</label>
                    <button type="button" class="remove-member" onclick="removeMember(this)" style="display: none;">‚ùå</button>
                </div>
            `;
            
            // Event Listener neu hinzuf√ºgen
            const fileInputs = container.querySelectorAll('.file-input');
            fileInputs.forEach(input => {
                input.addEventListener('change', handleFileUpload);
            });
            
            memberCounter = 2;
        }

        function displayGroups() {
            const display = document.getElementById('groupsDisplay');
            
            if (groups.length === 0) {
                display.innerHTML = '<p style="text-align: center; color: #6c757d; font-style: italic;">Noch keine Gruppen erstellt.</p>';
                return;
            }
            
            display.innerHTML = groups.map(group => `
                <div class="group-card">
                    <div class="group-header">
                        <div class="group-name">${group.name}</div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-edit" onclick="editGroup(${group.id})">‚úèÔ∏è Bearbeiten</button>
                            <button class="btn btn-danger" onclick="deleteGroup(${group.id})">üóëÔ∏è L√∂schen</button>
                        </div>
                    </div>
                    <div id="group-content-${group.id}">
                        ${group.members.map(member => `
                            <div class="member-card">
                                <div class="member-name">${member.name}</div>
                                ${member.signature ? `<img src="${member.signature}" class="member-signature" alt="Unterschrift">` : '<span style="color: #6c757d; font-style: italic;">Keine Unterschrift</span>'}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function deleteGroup(groupId) {
            if (confirm('Gruppe wirklich l√∂schen?')) {
                groups = groups.filter(group => group.id !== groupId);
                saveGroups();
                displayGroups();
                showMessage('Gruppe erfolgreich gel√∂scht!', 'success');
            }
        }

        function editGroup(groupId) {
            const group = groups.find(g => g.id === groupId);
            if (!group) return;

            const contentDiv = document.getElementById(`group-content-${groupId}`);
            
            // Bearbeitungsformular erstellen
            const editForm = document.createElement('div');
            editForm.className = 'edit-form';
            editForm.innerHTML = `
                <h4 style="margin-bottom: 15px; color: #856404;">‚úèÔ∏è ${group.name} bearbeiten</h4>
                <div id="edit-members-${groupId}">
                    ${group.members.map((member, index) => `
                        <div class="edit-member-input">
                            <input type="text" class="edit-name-input" value="${member.name}" placeholder="Name des Mitglieds">
                            <input type="file" class="file-input" accept=".png,.jpg,.jpeg" id="edit-file-${groupId}-${index}" style="display: none;">
                            <label for="edit-file-${groupId}-${index}" class="file-label">üìé ${member.signature ? 'Unterschrift √§ndern' : 'Unterschrift hinzuf√ºgen'}</label>
                            ${member.signature ? `<img src="${member.signature}" class="signature-preview" alt="Aktuelle Unterschrift">` : ''}
                            ${group.members.length > 1 ? `<button type="button" class="remove-member" onclick="removeEditMember(this, ${groupId})">‚ùå</button>` : ''}
                        </div>
                    `).join('')}
                </div>
                <div class="edit-actions">
                    ${group.members.length < 3 ? `<button type="button" class="btn btn-secondary" onclick="addEditMember(${groupId})">‚ûï Mitglied hinzuf√ºgen</button>` : ''}
                    <button type="button" class="btn btn-save-edit" onclick="saveGroupEdit(${groupId})">üíæ √Ñnderungen speichern</button>
                    <button type="button" class="btn btn-cancel-edit" onclick="cancelGroupEdit(${groupId})">‚ùå Abbrechen</button>
                </div>
            `;

            // Originalen Inhalt ausblenden und Bearbeitungsformular anzeigen
            contentDiv.style.display = 'none';
            contentDiv.parentNode.appendChild(editForm);

            // Event Listener f√ºr Datei-Uploads hinzuf√ºgen
            const fileInputs = editForm.querySelectorAll('.file-input');
            fileInputs.forEach(input => {
                input.addEventListener('change', handleEditFileUpload);
            });
        }

        function addEditMember(groupId) {
            const container = document.getElementById(`edit-members-${groupId}`);
            const memberInputs = container.querySelectorAll('.edit-member-input');
            
            if (memberInputs.length >= 3) {
                showMessage('Maximal 3 Mitglieder pro Gruppe erlaubt!', 'error');
                return;
            }

            const newIndex = memberInputs.length;
            const memberDiv = document.createElement('div');
            memberDiv.className = 'edit-member-input';
            memberDiv.innerHTML = `
                <input type="text" class="edit-name-input" value="" placeholder="Name des Mitglieds">
                <input type="file" class="file-input" accept=".png,.jpg,.jpeg" id="edit-file-${groupId}-${newIndex}" style="display: none;">
                <label for="edit-file-${groupId}-${newIndex}" class="file-label">üìé Unterschrift hinzuf√ºgen</label>
                <button type="button" class="remove-member" onclick="removeEditMember(this, ${groupId})">‚ùå</button>
            `;
            
            container.appendChild(memberDiv);
            
            // Event Listener f√ºr neuen Datei-Upload hinzuf√ºgen
            const fileInput = memberDiv.querySelector('.file-input');
            fileInput.addEventListener('change', handleEditFileUpload);

            // "Mitglied hinzuf√ºgen" Button ausblenden wenn 3 Mitglieder erreicht
            const addButton = document.querySelector(`[onclick="addEditMember(${groupId})"]`);
            if (container.querySelectorAll('.edit-member-input').length >= 3 && addButton) {
                addButton.style.display = 'none';
            }
        }

        function removeEditMember(button, groupId) {
            const memberInput = button.parentElement;
            const container = document.getElementById(`edit-members-${groupId}`);
            
            memberInput.remove();
            
            // "Mitglied hinzuf√ºgen" Button wieder anzeigen wenn unter 3 Mitglieder
            const addButton = document.querySelector(`[onclick="addEditMember(${groupId})"]`);
            if (container.querySelectorAll('.edit-member-input').length < 3 && addButton) {
                addButton.style.display = 'inline-block';
            }
        }

        function handleEditFileUpload(event) {
            const file = event.target.files[0];
            const memberInput = event.target.parentElement;
            
            // Vorherige Vorschau entfernen
            const existingPreview = memberInput.querySelector('.signature-preview');
            if (existingPreview) {
                existingPreview.remove();
            }
            
            if (file) {
                // Dateigr√∂√üe pr√ºfen (max 2MB)
                if (file.size > 2 * 1024 * 1024) {
                    showMessage('Datei zu gro√ü! Maximal 2MB erlaubt.', 'error');
                    event.target.value = '';
                    return;
                }
                
                // Bildvorschau erstellen
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'signature-preview';
                    img.alt = 'Unterschrift Vorschau';
                    memberInput.appendChild(img);
                    
                    // Label Text aktualisieren
                    const label = memberInput.querySelector('.file-label');
                    label.textContent = 'üìé Unterschrift √§ndern';
                };
                reader.readAsDataURL(file);
            }
        }

        function saveGroupEdit(groupId) {
            const group = groups.find(g => g.id === groupId);
            if (!group) return;

            const container = document.getElementById(`edit-members-${groupId}`);
            const memberInputs = container.querySelectorAll('.edit-member-input');
            
            if (memberInputs.length < 1) {
                showMessage('Mindestens 1 Mitglied erforderlich!', 'error');
                return;
            }
            
            const newMembers = [];
            let hasEmptyName = false;
            let processedFiles = 0;
            const totalFiles = Array.from(memberInputs).filter(div => div.querySelector('.file-input').files[0]).length;
            
            memberInputs.forEach((memberDiv, index) => {
                const nameInput = memberDiv.querySelector('.edit-name-input');
                const fileInput = memberDiv.querySelector('.file-input');
                
                if (!nameInput.value.trim()) {
                    hasEmptyName = true;
                    return;
                }
                
                const member = {
                    name: nameInput.value.trim(),
                    signature: group.members[index] ? group.members[index].signature : null
                };
                
                if (fileInput.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        member.signature = e.target.result;
                        processedFiles++;
                        
                        if (processedFiles === totalFiles || totalFiles === 0) {
                            finalizeGroupEdit(groupId, newMembers);
                        }
                    };
                    reader.readAsDataURL(fileInput.files[0]);
                } else {
                    // Kein neues Bild, also vorhandenes beibehalten oder null
                    const existingPreview = memberDiv.querySelector('.signature-preview');
                    if (existingPreview && existingPreview.src.startsWith('data:')) {
                        member.signature = existingPreview.src;
                    }
                }
                
                newMembers.push(member);
            });
            
            if (hasEmptyName) {
                showMessage('Alle Mitglieder m√ºssen einen Namen haben!', 'error');
                return;
            }
            
            if (totalFiles === 0) {
                finalizeGroupEdit(groupId, newMembers);
            }
        }

        function finalizeGroupEdit(groupId, newMembers) {
            const group = groups.find(g => g.id === groupId);
            if (!group) return;
            
            group.members = newMembers;
            saveGroups();
            displayGroups();
            showMessage(`${group.name} erfolgreich aktualisiert!`, 'success');
        }

        function cancelGroupEdit(groupId) {
            const contentDiv = document.getElementById(`group-content-${groupId}`);
            const editForm = contentDiv.parentNode.querySelector('.edit-form');
            
            if (editForm) {
                editForm.remove();
            }
            contentDiv.style.display = 'block';
        }

        function deleteAllGroups() {
            if (confirm('Wirklich alle Gruppen l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden!')) {
                groups = [];
                groupCounter = 1;
                saveGroups();
                displayGroups();
                document.getElementById('classesSection').style.display = 'none';
                showMessage('Alle Gruppen erfolgreich gel√∂scht! Die vordefinierten Gruppen wurden ebenfalls entfernt.', 'success');
            }
        }

        function createClasses() {
            if (groups.length === 0) {
                showMessage('Keine Gruppen zum Aufteilen vorhanden!', 'error');
                return;
            }
            
            // Gruppen mischen
            const shuffledGroups = [...groups].sort(() => Math.random() - 0.5);
            
            // Auf 3 Klassen aufteilen
            const classA = [];
            const classB = [];
            const classC = [];
            const classes = [classA, classB, classC];
            
            // Gruppen gleichm√§√üig verteilen
            shuffledGroups.forEach((group, index) => {
                classes[index % 3].push(group);
            });
            
            // Anzeige der Klassen
            displayClasses([classA, classB, classC]);
            document.getElementById('classesSection').style.display = 'block';
            
            showMessage('Klassen erfolgreich erstellt!', 'success');
        }

        function displayClasses(classes) {
            const display = document.getElementById('classesDisplay');
            const classNames = ['Klasse A', 'Klasse B', 'Klasse C'];
            const classColors = ['class-a', 'class-b', 'class-c'];
            
            display.innerHTML = classes.map((classGroups, index) => {
                const memberCount = classGroups.reduce((sum, group) => sum + group.members.length, 0);
                
                return `
                    <div class="class-card ${classColors[index]}">
                        <div class="class-header">
                            <div class="class-name">${classNames[index]}</div>
                            <div class="class-count">${memberCount} Personen in ${classGroups.length} Gruppen</div>
                        </div>
                        ${classGroups.map(group => `
                            <div class="group-card" style="margin-bottom: 15px;">
                                <div class="group-name" style="margin-bottom: 10px;">${group.name}</div>
                                ${group.members.map(member => `
                                    <div class="member-card">
                                        <div class="member-name">${member.name}</div>
                                        ${member.signature ? `<img src="${member.signature}" class="member-signature" alt="Unterschrift">` : '<span style="color: #6c757d; font-style: italic;">Keine Unterschrift</span>'}
                                    </div>
                                `).join('')}
                            </div>
                        `).join('')}
                    </div>
                `;
            }).join('');
        }

        function updateStats() {
            const totalGroups = groups.length;
            const totalMembers = groups.reduce((sum, group) => sum + group.members.length, 0);
            
            document.getElementById('totalGroups').textContent = totalGroups;
            document.getElementById('totalMembers').textContent = totalMembers;
        }

        function showMessage(message, type) {
            const messageArea = document.getElementById('messageArea');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type === 'error' ? 'error' : 'success'}`;
            alertDiv.textContent = message;
            
            messageArea.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // Event Listener f√ºr initiale Datei-Uploads hinzuf√ºgen
        document.addEventListener('DOMContentLoaded', function() {
            const initialFileInputs = document.querySelectorAll('.file-input');
            initialFileInputs.forEach(input => {
                input.addEventListener('change', handleFileUpload);
            });
        });
    </script>
</body>
</html>
