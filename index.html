<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Snake.io Mobile</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }

        body {
            overflow: hidden;
            background: #0f172a;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        #gameCanvas {
            display: block;
            background: #0f172a;
            width: 100%;
            height: 100%;
        }

        /* Mobile Controls - Joystick Style */
        .joystick-area {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: rgba(15, 23, 42, 0.7);
            border: 2px solid rgba(74, 222, 128, 0.3);
            z-index: 100;
        }

        .joystick {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(74, 222, 128, 0.7);
            top: 35px;
            left: 35px;
            transition: transform 0.1s;
        }

        .boost-btn {
            position: fixed;
            right: 30px;
            bottom: 30px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(248, 113, 113, 0.3);
            border: 2px solid rgba(248, 113, 113, 0.5);
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: all 0.2s;
        }

        .boost-btn.active {
            background: rgba(248, 113, 113, 0.7);
            transform: scale(1.1);
        }

        .game-stats {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(15, 23, 42, 0.8);
            padding: 12px 16px;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            z-index: 100;
            border: 1px solid rgba(74, 222, 128, 0.2);
        }

        .game-over {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(15, 23, 42, 0.95);
            padding: 24px;
            border-radius: 16px;
            color: white;
            text-align: center;
            display: none;
            z-index: 200;
            width: 85%;
            max-width: 320px;
            border: 2px solid rgba(248, 113, 113, 0.5);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }

        .restart-btn {
            margin-top: 20px;
            padding: 12px 24px;
            background: linear-gradient(to right, #4ade80, #3b82f6);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            font-size: 16px;
            width: 100%;
        }

        /* Responsive Anpassungen */
        @media (max-width: 400px) {
            .joystick-area {
                width: 100px;
                height: 100px;
                bottom: 20px;
                left: 20px;
            }
            .joystick {
                width: 40px;
                height: 40px;
                top: 30px;
                left: 30px;
            }
            .boost-btn {
                width: 70px;
                height: 70px;
                right: 20px;
                bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <div class="game-stats">
        <div>üêç <span id="score">10</span></div>
        <div>‚≠ê <span id="points">0</span></div>
    </div>
    
    <div class="joystick-area">
        <div class="joystick" id="joystick"></div>
    </div>
    
    <div class="boost-btn" id="boostBtn">üöÄ</div>
    
    <div id="gameOver" class="game-over">
        <h2 style="margin-bottom: 16px; color: #f87171">Game Over!</h2>
        <div style="margin: 8px 0">L√§nge: <span id="finalScore">0</span></div>
        <div style="margin: 8px 0">Punkte: <span id="finalPoints">0</span></div>
        <button class="restart-btn" onclick="restartGame()">Nochmal spielen</button>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const joystick = document.getElementById("joystick");
        const joystickArea = document.querySelector(".joystick-area");
        const boostBtn = document.getElementById("boostBtn");
        
        // Canvas anpassen
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // Spielzustand
        let gameState = {
            snake: [{ x: canvas.width / 2, y: canvas.height / 2 }],
            direction: { x: 1, y: 0 },
            size: 10,
            speed: 3,
            food: [],
            gameRunning: true,
            points: 0,
            boost: false,
            touchStart: null,
            joystickActive: false
        };
        
        // Joystick Steuerung
        joystickArea.addEventListener('touchstart', handleTouchStart);
        joystickArea.addEventListener('touchmove', handleTouchMove);
        joystickArea.addEventListener('touchend', handleTouchEnd);
        
        function handleTouchStart(e) {
            gameState.joystickActive = true;
            gameState.touchStart = {
                x: e.touches[0].clientX,
                y: e.touches[0].clientY
            };
            updateJoystickPosition(e.touches[0].clientX, e.touches[0].clientY);
        }
        
        function handleTouchMove(e) {
            if (!gameState.joystickActive) return;
            e.preventDefault();
            updateJoystickPosition(e.touches[0].clientX, e.touches[0].clientY);
        }
        
        function handleTouchEnd() {
            gameState.joystickActive = false;
            joystick.style.transform = 'translate(0, 0)';
            gameState.direction = { x: 0, y: 0 };
        }
        
        function updateJoystickPosition(touchX, touchY) {
            const rect = joystickArea.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            const deltaX = touchX - centerX;
            const deltaY = touchY - centerY;
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            const maxDistance = rect.width / 2 - 25;
            
            const limitedDistance = Math.min(distance, maxDistance);
            const angle = Math.atan2(deltaY, deltaX);
            
            const moveX = limitedDistance * Math.cos(angle);
            const moveY = limitedDistance * Math.sin(angle);
            
            joystick.style.transform = `translate(${moveX}px, ${moveY}px)`;
            
            // Richtung basierend auf Joystick-Position
            if (distance > 20) {
                gameState.direction = {
                    x: Math.cos(angle),
                    y: Math.sin(angle)
                };
            } else {
                gameState.direction = { x: 0, y: 0 };
            }
        }
        
        // Boost Button
        boostBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            gameState.boost = true;
            boostBtn.classList.add('active');
        });
        
        boostBtn.addEventListener('touchend', (e) => {
            e.preventDefault();
            gameState.boost = false;
            boostBtn.classList.remove('active');
        });
        
        // Futter generieren
        function spawnFood() {
            if (gameState.food.length < 15) {
                gameState.food.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    color: `hsl(${Math.random() * 360}, 80%, 60%)`,
                    size: 8 + Math.random() * 4
                });
            }
        }
        
        // Spiel-Update
        function update() {
            if (!gameState.gameRunning) return;
            
            const head = gameState.snake[0];
            const speed = gameState.boost ? gameState.speed * 1.8 : gameState.speed;
            
            // Nur bewegen wenn Joystick aktiv
            if (gameState.joystickActive) {
                const newHead = {
                    x: head.x + gameState.direction.x * speed,
                    y: head.y + gameState.direction.y * speed
                };
                gameState.snake.unshift(newHead);
            }
            
            // L√§nge anpassen
            while (gameState.snake.length > gameState.size) {
                gameState.snake.pop();
            }
            
            // Wandkollision
            const headPos = gameState.snake[0];
            if (headPos.x < 0 || headPos.x > canvas.width || 
                headPos.y < 0 || headPos.y > canvas.height) {
                gameOver();
                return;
            }
            
            // Selbstkollision (nur wenn lang genug)
            if (gameState.size > 15) {
                for (let i = 10; i < gameState.snake.length; i++) {
                    if (Math.hypot(headPos.x - gameState.snake[i].x, 
                                  headPos.y - gameState.snake[i].y) < 12) {
                        gameOver();
                        return;
                    }
                }
            }
            
            // Futterkollision
            for (let i = gameState.food.length - 1; i >= 0; i--) {
                const food = gameState.food[i];
                if (Math.hypot(food.x - headPos.x, food.y - headPos.y) < 12 + food.size/2) {
                    gameState.size += food.size/4;
                    gameState.points += Math.floor(food.size);
                    gameState.food.splice(i, 1);
                    updateUI();
                    
                    // Kleiner Geschwindigkeits-Boost beim Fressen
                    gameState.speed = Math.min(6, gameState.speed + 0.05);
                }
            }
            
            spawnFood();
        }
        
        // Zeichnen
        function draw() {
            // Hintergrund mit feinem Raster
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Raster zeichnen
            ctx.strokeStyle = 'rgba(74, 222, 128, 0.05)';
            ctx.lineWidth = 1;
            const gridSize = 40;
            
            for (let x = 0; x < canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            for (let y = 0; y < canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // Futter
            gameState.food.forEach(food => {
                ctx.fillStyle = food.color;
                ctx.beginPath();
                ctx.arc(food.x, food.y, food.size, 0, Math.PI * 2);
                ctx.fill();
                
                // Glow-Effekt
                ctx.shadowColor = food.color;
                ctx.shadowBlur = 15;
                ctx.beginPath();
                ctx.arc(food.x, food.y, food.size * 0.7, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
            });
            
            // Schlange
            gameState.snake.forEach((segment, index) => {
                const opacity = 1 - (index / gameState.snake.length) * 0.7;
                const hue = (index * 3 + Date.now() * 0.01) % 360;
                const color = gameState.boost ? 
                    `hsla(0, 80%, 65%, ${opacity})` : 
                    `hsla(${hue}, 80%, 60%, ${opacity})`;
                
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(segment.x, segment.y, 10, 0, Math.PI * 2);
                ctx.fill();
                
                // Kopf
                if (index === 0) {
                    ctx.fillStyle = "white";
                    const eyeOffsetX = 6 * gameState.direction.x;
                    const eyeOffsetY = 6 * gameState.direction.y;
                    
                    // Augen
                    ctx.beginPath();
                    ctx.arc(
                        segment.x - eyeOffsetY/2 - eyeOffsetX, 
                        segment.y - eyeOffsetX/2 + eyeOffsetY, 
                        3, 0, Math.PI * 2
                    );
                    ctx.arc(
                        segment.x + eyeOffsetY/2 - eyeOffsetX, 
                        segment.y + eyeOffsetX/2 + eyeOffsetY, 
                        3, 0, Math.PI * 2
                    );
                    ctx.fill();
                    
                    // Boost-Effekt
                    if (gameState.boost) {
                        ctx.strokeStyle = 'rgba(248, 113, 113, 0.5)';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.arc(segment.x, segment.y, 15, 0, Math.PI * 2);
                        ctx.stroke();
                    }
                }
            });
        }
        
        // UI aktualisieren
        function updateUI() {
            document.getElementById("score").textContent = Math.floor(gameState.size);
            document.getElementById("points").textContent = gameState.points;
        }
        
        // Game Over
        function gameOver() {
            gameState.gameRunning = false;
            document.getElementById("finalScore").textContent = Math.floor(gameState.size);
            document.getElementById("finalPoints").textContent = gameState.points;
            document.getElementById("gameOver").style.display = "block";
        }
        
        // Neustart
        function restartGame() {
            gameState = {
                snake: [{ x: canvas.width / 2, y: canvas.height / 2 }],
                direction: { x: 1, y: 0 },
                size: 10,
                speed: 3,
                food: [],
                gameRunning: true,
                points: 0,
                boost: false,
                touchStart: null,
                joystickActive: false
            };
            
            document.getElementById("gameOver").style.display = "none";
            updateUI();
        }
        
        // Hauptspielschleife
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        // Spiel starten
        spawnFood();
        gameLoop();
        
        // Willkommensnachricht
        setTimeout(() => {
            if (gameState.gameRunning) {
                const welcome = document.createElement('div');
                welcome.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(15, 23, 42, 0.95);
                    padding: 20px;
                    border-radius: 16px;
                    color: white;
                    text-align: center;
                    z-index: 200;
                    width: 85%;
                    max-width: 320px;
                    border: 2px solid rgba(74, 222, 128, 0.5);
                `;
                welcome.innerHTML = `
                    <h3 style="margin-bottom: 12px;">Snake.io Mobile</h3>
                    <p style="margin-bottom: 8px;">Bewege den Joystick links</p>
                    <p style="margin-bottom: 16px;">Halte üöÄ f√ºr Boost</p>
                    <button onclick="this.parentElement.remove()" style="
                        margin-top: 8px;
                        padding: 10px 20px;
                        background: linear-gradient(to right, #4ade80, #3b82f6);
                        border: none;
                        border-radius: 8px;
                        color: white;
                        font-weight: bold;
                        width: 100%;
                    ">Starten</button>
                `;
                document.body.appendChild(welcome);
            }
        }, 500);
    </script>
</body>
</html>
