<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=1.0">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://www.gstatic.com https://cdnjs.cloudflare.com https://www.googletagmanager.com; script-src 'self' 'unsafe-inline' https://www.gstatic.com https://cdnjs.cloudflare.com https://www.googletagmanager.com https://www.google-analytics.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; img-src 'self' data: https://offertly.example.com;">
    <title>Offertly - KI-Angebotsgenerator für Selbstständige</title>
    <meta name="description" content="Professionelle Angebote in Minuten erstellen mit künstlicher Intelligenz für Handwerker, Freelancer und Selbstständige">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="canonical" href="https://offertly.example.com/" />
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://offertly.example.com/">
    <meta property="og:title" content="Offertly - KI-Angebotsgenerator">
    <meta property="og:description" content="Professionelle Angebote in Minuten erstellen mit KI">
    <meta property="og:image" content="https://offertly.example.com/images/social-preview.jpg">
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://offertly.example.com/">
    <meta property="twitter:title" content="Offertly - KI-Angebotsgenerator">
    <meta property="twitter:description" content="Professionelle Angebote in Minuten erstellen mit KI">
    <meta property="twitter:image" content="https://offertly.example.com/images/social-preview.jpg">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Offertly - KI-Angebotsgenerator",
      "description": "Professionelle Angebote in Minuten erstellen mit künstlicher Intelligenz für Handwerker, Freelancer und Selbstständige",
      "applicationCategory": "BusinessApplication",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "9.00",
        "priceCurrency": "EUR"
      }
    }
    </script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YOURID"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-YOURID', { 
        'anonymize_ip': true,
        'cookie_flags': 'SameSite=None;Secure'
      });
    </script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #2a4bc9;
            --secondary: #3a0ca3;
            --accent: #4cc9f0;
            --light: #ffffff;
            --dark: #121826;
            --gray: #6c757d;
            --light-gray: #f5f7fa;
            --border-radius: 12px;
            --shadow: 0 10px 30px rgba(0,0,0,0.05);
            --transition: all 0.3s ease;
            --card-shadow: 0 8px 24px rgba(0,0,0,0.04);
            --header-height: 80px;
            --error: #e53e3e;
            --success: #38a169;
            --warning: #dd6b20;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background-color: var(--light-gray);
            color: var(--dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.6;
        }

        /* Header Styling */
        header {
            height: var(--header-height);
            background: var(--light);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            padding: 0 5%;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            font-size: 28px;
            color: var(--primary);
        }

        .logo-text {
            font-size: 22px;
            font-weight: 700;
            color: var(--dark);
            letter-spacing: -0.5px;
        }

        .ai-badge {
            background: linear-gradient(135deg, var(--accent) 0%, #06b6d4 100%);
            color: var(--dark);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .premium-badge {
            background: linear-gradient(135deg, #f72585 0%, #7209b7 100%) !important;
        }

        .enterprise-badge {
            background: linear-gradient(135deg, #ff9a00 0%, #ff5e00 100%) !important;
        }

        nav {
            margin-left: auto;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .nav-link {
            color: #4a5568;
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
        }

        .nav-link:hover {
            color: var(--primary);
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.25);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .btn-secondary:hover {
            background: rgba(67, 97, 238, 0.05);
        }

        /* Main Content */
        .main-container {
            flex: 1;
            padding: 30px 5%;
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
        }

        .hero-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 60px;
        }

        @media (max-width: 1024px) {
            .hero-section {
                grid-template-columns: 1fr;
            }
        }

        .hero-text {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .hero-title {
            font-size: 36px;
            font-weight: 800;
            line-height: 1.2;
            color: var(--dark);
            margin-bottom: 20px;
        }

        .hero-title span {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .hero-subtitle {
            font-size: 18px;
            color: #4a5568;
            margin-bottom: 30px;
            font-weight: 400;
        }

        .app-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 60px;
        }

        @media (max-width: 1024px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }

        .app-card {
            background: var(--light);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .card-header {
            padding: 25px 30px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: rgba(67, 97, 238, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 18px;
        }

        .card-body {
            padding: 30px;
            flex: 1;
            overflow-y: auto;
        }

        /* Form Styling */
        .form-section {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        label {
            font-weight: 600;
            font-size: 14px;
            color: var(--dark);
        }

        .required::after {
            content: " *";
            color: var(--error);
        }

        input, textarea, select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 15px;
            transition: var(--transition);
            background: var(--light);
            color: var(--dark);
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .input-hint {
            font-size: 13px;
            color: var(--gray);
            font-style: italic;
            margin-top: 5px;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        /* Error Styling */
        .error-message {
            color: var(--error);
            font-size: 13px;
            margin-top: 5px;
            display: none;
        }

        .has-error input,
        .has-error textarea,
        .has-error select {
            border-color: var(--error);
            box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.1);
        }

        .has-error .error-message {
            display: block;
        }

        /* Custom Branch Input */
        .custom-branch {
            display: none;
            margin-top: 10px;
        }

        .custom-branch.show {
            display: block;
        }

        /* Preview Styling */
        .preview-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            min-height: 100%;
            font-family: 'Georgia', serif;
            line-height: 1.6;
            box-shadow: 0 0 10px rgba(0,0,0,0.03);
            position: relative;
            border: 1px solid #edf2f7;
        }

        .offer-header {
            border-bottom: 2px solid var(--primary);
            padding-bottom: 25px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .company-info {
            flex: 1;
        }

        .company-name {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .company-address {
            color: var(--gray);
            font-size: 14px;
            line-height: 1.5;
        }

        .offer-meta {
            text-align: right;
        }

        .offer-number {
            font-size: 16px;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .offer-date {
            color: var(--gray);
            font-size: 14px;
        }

        .customer-info {
            background: var(--light-gray);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            font-size: 15px;
        }

        .customer-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--primary);
        }

        .offer-content {
            margin-bottom: 30px;
        }

        .offer-greeting {
            margin-bottom: 25px;
        }

        .service-description {
            background: #f0f4ff;
            padding: 25px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            margin: 25px 0;
            font-size: 15px;
        }

        .price-section {
            background: #f8faff;
            padding: 25px;
            border-radius: 8px;
            margin-top: 25px;
            border: 1px solid #e2e8f0;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 16px;
            padding: 5px 0;
        }

        .price-total {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
            border-top: 2px solid var(--primary);
            padding-top: 12px;
            margin-top: 12px;
        }

        .terms-section {
            margin-top: 35px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
            font-size: 13px;
            color: var(--gray);
        }

        .empty-preview {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            height: 100%;
            padding: 30px;
            color: var(--gray);
        }

        .empty-icon {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 25px;
            opacity: 0.6;
        }

        .empty-title {
            font-size: 22px;
            margin-bottom: 15px;
            color: var(--dark);
            font-weight: 600;
        }

        .empty-text {
            max-width: 400px;
            margin-bottom: 25px;
        }

        .loading {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            z-index: 10;
            border-radius: 8px;
            display: none;
        }

        .loading.show {
            display: flex;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid #e2e8f0;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            background: var(--accent);
            color: var(--dark);
            border-radius: 8px;
            font-weight: 600;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(100px);
            opacity: 0;
            transition: var(--transition);
            z-index: 1000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.error {
            background: var(--error);
            color: white;
        }

        .toast.success {
            background: var(--success);
            color: white;
        }

        /* Mobile Menu */
        .mobile-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 90;
            display: none;
        }

        .mobile-menu-overlay.show {
            display: block;
        }

        .mobile-nav {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100vh;
            background: white;
            z-index: 100;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            transition: var(--transition);
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
        }

        .mobile-nav.show {
            right: 0;
        }

        .mobile-nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .mobile-nav-link {
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
            color: var(--dark);
            text-decoration: none;
            font-weight: 500;
        }

        /* Footer */
        footer {
            background: var(--dark);
            color: #a0aec0;
            padding: 40px 5% 30px;
        }

        .footer-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 40px;
            max-width: 1400px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .footer-container {
                grid-template-columns: 1fr;
            }
        }

        .footer-logo {
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .footer-text {
            margin-bottom: 25px;
            line-height: 1.7;
        }

        .footer-heading {
            font-size: 18px;
            font-weight: 600;
            color: white;
            margin-bottom: 25px;
        }

        .footer-links {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .footer-link {
            color: #a0aec0;
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-link:hover {
            color: white;
        }

        .copyright {
            text-align: center;
            padding-top: 40px;
            margin-top: 40px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: #718096;
            font-size: 14px;
        }

        /* Legal Pages */
        .legal-page {
            max-width: 800px;
            margin: 40px auto;
            padding: 30px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
        }

        .legal-page h1 {
            color: var(--primary);
            margin-bottom: 30px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
        }

        .legal-page h2 {
            color: var(--primary);
            margin: 25px 0 15px;
        }

        .legal-page p {
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .legal-page ul {
            margin-bottom: 15px;
            padding-left: 20px;
        }

        /* Dark Mode */
        body.dark-mode {
            background-color: #1a202c;
            color: #e2e8f0;
        }

        body.dark-mode .app-card,
        body.dark-mode .preview-container,
        body.dark-mode .legal-page {
            background-color: #2d3748;
            color: #e2e8f0;
        }

        body.dark-mode input,
        body.dark-mode textarea,
        body.dark-mode select {
            background-color: #4a5568;
            color: #f7fafc;
            border-color: #4a5568;
        }

        body.dark-mode .customer-info,
        body.dark-mode .service-description,
        body.dark-mode .price-section {
            background-color: rgba(74, 85, 104, 0.5);
        }

        body.dark-mode header {
            background-color: #2d3748;
        }

        body.dark-mode .logo-text {
            color: #f7fafc;
        }

        body.dark-mode .nav-link {
            color: #cbd5e0;
        }

        body.dark-mode .nav-link:hover {
            color: var(--accent);
        }

        /* Theme Toggle */
        .theme-toggle {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 20px;
            margin-left: 15px;
        }

        /* Auth Buttons */
        .auth-buttons {
            display: flex;
            gap: 10px;
            margin-left: 20px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--light);
            margin: 10% auto;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 450px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
            position: relative;
        }

        .close-modal {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }

        /* Abo-Styles */
        .subscribe-btn {
            width: 100%;
            margin-top: 15px;
        }

        .plan-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .plan-option {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            padding: 25px;
            position: relative;
            cursor: pointer;
            transition: var(--transition);
        }

        .plan-option.selected {
            border: 2px solid var(--primary);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.1);
        }

        .plan-option h4 {
            font-size: 20px;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .plan-price {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .plan-price span {
            font-size: 14px;
            color: var(--gray);
            font-weight: normal;
        }

        .plan-option ul {
            list-style: none;
            margin-top: 15px;
        }

        .plan-option li {
            padding: 5px 0;
            display: flex;
            align-items: center;
        }

        .plan-option li i {
            margin-right: 8px;
            width: 16px;
        }

        .plan-option li .fa-check {
            color: var(--success);
        }

        .plan-option li .fa-times {
            color: var(--gray);
        }

        .popular-badge {
            position: absolute;
            top: -10px;
            right: 15px;
            background: var(--accent);
            color: var(--dark);
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .payment-methods {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .payment-method {
            flex: 1;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .payment-method.active {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }

        .payment-method i {
            margin: 0 3px;
            font-size: 20px;
        }

        .payment-details {
            margin: 25px 0;
        }

        .step-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .subscription-step {
            display: none;
        }

        .subscription-step.active {
            display: block;
        }

        .subscription-summary {
            background: var(--light-gray);
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 25px 0;
            text-align: left;
        }

        /* Account Section */
        .account-section {
            display: none;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Documents Section */
        .documents-section {
            display: none;
        }

        .documents-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .document-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--card-shadow);
            border: 1px solid #e2e8f0;
            transition: var(--transition);
        }

        .document-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .document-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .document-meta {
            font-size: 13px;
            color: var(--gray);
            margin-bottom: 15px;
        }

        .document-actions {
            display: flex;
            gap: 10px;
        }

        /* Team Section */
        .team-section {
            display: none;
        }

        .team-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .team-member {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--card-shadow);
            border: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .member-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-weight: bold;
        }

        .member-info {
            flex: 1;
        }

        .member-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .member-email {
            font-size: 13px;
            color: var(--gray);
        }

        .member-status {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 12px;
            background: var(--light-gray);
        }

        .member-status.active {
            background: rgba(56, 161, 105, 0.1);
            color: var(--success);
        }

        .member-status.pending {
            background: rgba(221, 107, 32, 0.1);
            color: var(--warning);
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            header {
                padding: 0 20px;
                height: 70px;
            }
            
            .logo-text {
                font-size: 18px;
            }
            
            .hero-title {
                font-size: 28px;
            }
            
            .hero-subtitle {
                font-size: 16px;
            }
            
            .main-container {
                padding: 20px;
            }
            
            .card-body {
                padding: 20px;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            nav {
                display: none;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .auth-buttons {
                display: none;
            }
            
            .modal-content {
                margin: 20% auto;
                width: 90%;
            }
        }
        
        @media (max-width: 480px) {
            .card-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .hero-title {
                font-size: 24px;
            }
            
            .hero-subtitle {
                font-size: 16px;
            }
            
            .plan-options {
                grid-template-columns: 1fr;
            }
            
            .preview-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .form-group input, 
            .form-group textarea, 
            .form-group select {
                font-size: 16px;
            }
            
            .price-row {
                flex-direction: column;
                gap: 5px;
            }
        }
        
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--primary);
            font-size: 24px;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
                margin-left: auto;
            }
        }

        /* Document Zoom Controls */
        .zoom-controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .zoom-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
        }

        .zoom-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* Signature Line */
        .signature-line {
            margin-top: 60px;
            border-top: 1px solid var(--gray);
            width: 200px;
            padding-top: 10px;
            text-align: center;
        }

        /* Document Versions */
        .version-badge {
            background: var(--light-gray);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }

        /* Document Comments */
        .comment-bubble {
            position: absolute;
            right: 10px;
            top: 10px;
            width: 24px;
            height: 24px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark);
            font-size: 12px;
            cursor: pointer;
        }

        /* PWA Install Prompt */
        .pwa-install {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: none;
        }

        .pwa-install.show {
            display: flex;
        }

        .pwa-close {
            margin-left: 10px;
            cursor: pointer;
        }

        /* Accessibility Improvements */
        [role="button"],
        button,
        input[type="submit"],
        input[type="reset"],
        input[type="button"] {
            cursor: pointer;
        }

        [tabindex="0"]:focus,
        button:focus,
        input:focus,
        select:focus,
        textarea:focus,
        a:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Improved Contrast for Dark Mode */
        body.dark-mode .btn-primary {
            color: white;
        }

        body.dark-mode .btn-secondary {
            color: var(--accent);
            border-color: var(--accent);
        }

        body.dark-mode .btn-secondary:hover {
            background: rgba(76, 201, 240, 0.1);
        }

        /* Form Validation Improvements */
        .has-success input,
        .has-success textarea,
        .has-success select {
            border-color: var(--success);
            box-shadow: 0 0 0 3px rgba(56, 161, 105, 0.1);
        }

        .has-success .success-message {
            display: block;
            color: var(--success);
            font-size: 13px;
            margin-top: 5px;
        }

        /* Loading Animation for Buttons */
        .btn-loading {
            position: relative;
        }

        .btn-loading::after {
            content: "";
            position: absolute;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            right: 10px;
        }

        /* Tooltip Styling */
        [data-tooltip] {
            position: relative;
        }

        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 10;
            margin-bottom: 5px;
        }

        /* Animation for Transitions */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Improved Form Feedback */
        .form-feedback {
            display: none;
            padding: 8px 12px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 14px;
        }

        .form-feedback.visible {
            display: block;
        }

        .form-feedback.success {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--success);
            border-left: 3px solid var(--success);
        }

        .form-feedback.error {
            background-color: rgba(229, 62, 62, 0.1);
            color: var(--error);
            border-left: 3px solid var(--error);
        }

        /* Language Toggle */
        .lang-toggle {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-left: 15px;
        }

        .lang-btn {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 14px;
            padding: 5px;
        }

        .lang-btn.active {
            color: var(--primary);
            font-weight: 600;
        }

        /* Offline Notification */
        .offline-notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--warning);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            z-index: 1000;
            display: none;
            box-shadow: var(--shadow);
        }

        .offline-notification.show {
            display: block;
        }

        /* Feedback Button */
        .feedback-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: var(--primary);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            z-index: 100;
        }

        /* Feedback Modal */
        .feedback-modal {
            position: fixed;
            bottom: 140px;
            right: 20px;
            width: 300px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            z-index: 101;
            display: none;
        }

        .feedback-modal.show {
            display: block;
        }

        .feedback-textarea {
            width: 100%;
            min-height: 100px;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }

        /* Analytics Opt-out */
        .analytics-opt-out {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            z-index: 1000;
            display: none;
            box-shadow: var(--shadow);
            max-width: 90%;
        }

        .analytics-opt-out.show {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Cookie Banner -->
    <div id="cookie-banner" style="position:fixed;bottom:0;left:0;right:0;background:#333;color:#fff;padding:15px;z-index:1000;display:none;">
        <div style="max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;">
            <p style="margin:0 15px 10px 0;">Wir verwenden Cookies, um Ihnen das beste Erlebnis auf unserer Website zu bieten.</p>
            <div>
                <button id="accept-cookies" style="background:#4361ee;color:white;border:none;padding:8px 15px;margin-right:10px;cursor:pointer;">Akzeptieren</button>
                <button id="reject-cookies" style="background:transparent;color:#aaa;border:1px solid #aaa;padding:8px 15px;cursor:pointer;">Ablehnen</button>
            </div>
        </div>
    </div>

    <!-- PWA Install Prompt -->
    <div class="pwa-install" id="pwaInstall">
        <i class="fas fa-download"></i>
        Offertly installieren
        <span class="pwa-close" id="pwaClose">&times;</span>
    </div>

    <!-- Offline Notification -->
    <div class="offline-notification" id="offlineNotification">
        <i class="fas fa-wifi"></i> Sie sind offline. Einige Funktionen sind möglicherweise eingeschränkt.
    </div>

    <!-- Analytics Opt-out -->
    <div class="analytics-opt-out" id="analyticsOptOut">
        <p>Möchten Sie das Tracking durch Google Analytics deaktivieren?</p>
        <div style="display: flex; gap: 10px; margin-top: 10px;">
            <button class="btn btn-secondary" id="disableAnalytics">Ja, deaktivieren</button>
            <button class="btn btn-primary" id="keepAnalytics">Nein, beibehalten</button>
        </div>
    </div>

    <!-- Feedback Button -->
    <div class="feedback-btn" id="feedbackBtn" aria-label="Feedback geben" role="button" tabindex="0">
        <i class="fas fa-comment-alt"></i>
    </div>

    <!-- Feedback Modal -->
    <div class="feedback-modal" id="feedbackModal">
        <h3 style="margin-bottom: 10px;">Feedback senden</h3>
        <textarea class="feedback-textarea" placeholder="Ihr Feedback..."></textarea>
        <div style="display: flex; justify-content: space-between;">
            <button class="btn btn-secondary" id="cancelFeedback">Abbrechen</button>
            <button class="btn btn-primary" id="submitFeedback">Senden</button>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="logo-container">
            <i class="fas fa-file-invoice-dollar logo-icon"></i>
            <div class="logo-text">Offertly</div>
            <span class="ai-badge">KI-Powered</span>
        </div>
        
        <nav id="desktopNav">
            <a href="#" class="nav-link">Start</a>
            <a href="#features" class="nav-link">Funktionen</a>
            <a href="#pricing" class="nav-link">Preise</a>
            <a href="#impressum" class="nav-link">Impressum</a>
            <div class="lang-toggle" aria-label="Sprachauswahl">
                <button class="lang-btn active" data-lang="de">DE</button>
                <button class="lang-btn" data-lang="en">EN</button>
            </div>
            <button class="theme-toggle" id="themeToggle" title="Dark Mode umschalten" aria-label="Dark Mode umschalten">
                <i class="fas fa-moon"></i>
            </button>
        </nav>
        
        <div class="auth-buttons">
            <button class="btn btn-secondary" id="loginBtn">
                <i class="fas fa-sign-in-alt"></i> Anmelden
            </button>
            <button class="btn btn-primary" id="registerBtn">
                <i class="fas fa-user-plus"></i> Registrieren
            </button>
        </div>
        
        <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Menü öffnen">
            <i class="fas fa-bars"></i>
        </button>
    </header>

    <!-- Mobile Navigation -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>
    <div class="mobile-nav" id="mobileNav">
        <div class="mobile-nav-header">
            <div class="logo-container">
                <i class="fas fa-file-invoice-dollar logo-icon"></i>
                <div class="logo-text">Offertly</div>
            </div>
            <button class="mobile-menu-btn" id="mobileCloseBtn" aria-label="Menü schließen">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <a href="#" class="mobile-nav-link">Start</a>
        <a href="#features" class="mobile-nav-link">Funktionen</a>
        <a href="#pricing" class="mobile-nav-link">Preise</a>
        <a href="#impressum" class="mobile-nav-link">Impressum</a>
        <a href="javascript:showLegalPage('datenschutz')" class="mobile-nav-link">Datenschutz</a>
        <a href="javascript:showLegalPage('agb')" class="mobile-nav-link">AGB</a>
        <button class="btn btn-secondary" id="mobileThemeToggle">
            <i class="fas fa-moon"></i> Dark Mode
        </button>
        <button class="btn btn-secondary" id="mobileLoginBtn">
            <i class="fas fa-sign-in-alt"></i> Anmelden
        </button>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Anmelden</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">E-Mail</label>
                    <input type="email" id="loginEmail" required aria-required="true">
                    <div class="form-feedback error" id="loginEmailError"></div>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Passwort</label>
                    <input type="password" id="loginPassword" required aria-required="true">
                    <div class="form-feedback error" id="loginPasswordError"></div>
                </div>
                <button type="submit" class="btn btn-primary">Anmelden</button>
                <p style="text-align: center; margin-top: 15px;">
                    <a href="#" id="forgotPassword">Passwort vergessen?</a>
                </p>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Registrieren</h2>
            <form id="registerForm">
                <div class="form-group">
                    <label for="regName">Name</label>
                    <input type="text" id="regName" required aria-required="true">
                    <div class="form-feedback error" id="regNameError"></div>
                </div>
                <div class="form-group">
                    <label for="regEmail">E-Mail</label>
                    <input type="email" id="regEmail" required aria-required="true">
                    <div class="form-feedback error" id="regEmailError"></div>
                </div>
                <div class="form-group">
                    <label for="regPassword">Passwort</label>
                    <input type="password" id="regPassword" required aria-required="true" minlength="8">
                    <div class="input-hint">Mindestens 8 Zeichen</div>
                    <div class="form-feedback error" id="regPasswordError"></div>
                </div>
                <div class="form-group">
                    <label for="regConfirmPassword">Passwort bestätigen</label>
                    <input type="password" id="regConfirmPassword" required aria-required="true">
                    <div class="form-feedback error" id="regConfirmPasswordError"></div>
                </div>
                <button type="submit" class="btn btn-primary">Konto erstellen</button>
            </form>
        </div>
    </div>

    <!-- Account Modal -->
    <div class="modal" id="accountModal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Konto-Einstellungen</h2>
            
            <form id="accountForm">
                <div class="form-group">
                    <label for="accountName">Name</label>
                    <input type="text" id="accountName" required aria-required="true">
                    <div class="form-feedback error" id="accountNameError"></div>
                </div>
                
                <div class="form-group">
                    <label for="accountEmail">E-Mail</label>
                    <input type="email" id="accountEmail" required aria-required="true">
                    <div class="form-feedback error" id="accountEmailError"></div>
                </div>
                
                <div class="form-group">
                    <label for="currentPassword">Aktuelles Passwort</label>
                    <input type="password" id="currentPassword">
                    <div class="form-feedback error" id="currentPasswordError"></div>
                </div>
                
                <div class="form-group">
                    <label for="newPassword">Neues Passwort</label>
                    <input type="password" id="newPassword">
                    <div class="form-feedback error" id="newPasswordError"></div>
                </div>
                
                <div class="form-group">
                    <label for="confirmPassword">Passwort bestätigen</label>
                    <input type="password" id="confirmPassword">
                    <div class="form-feedback error" id="confirmPasswordError"></div>
                </div>
                
                <button type="submit" class="btn btn-primary">Speichern</button>
            </form>
            
            <div style="margin-top: 30px;">
                <button class="btn btn-secondary" id="verifyEmailBtn">
                    <i class="fas fa-envelope"></i> E-Mail verifizieren
                </button>
            </div>
        </div>
    </div>

    <!-- Abo Modal -->
    <div class="modal" id="subscriptionModal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close-modal">&times;</span>
            <h2>Abonnement abschließen</h2>
            <div id="subscriptionSteps">
                <!-- Schritt 1: Planauswahl -->
                <div class="subscription-step active" id="step1">
                    <h3>Wählen Sie Ihren Plan</h3>
                    <div class="plan-options">
                        <div class="plan-option" data-plan="basis" tabindex="0" role="button" aria-label="Basis-Plan auswählen">
                            <h4>Basis</h4>
                            <div class="plan-price">€0<span>/Monat</span></div>
                            <ul>
                                <li><i class="fas fa-check"></i> 5 Angebote/Monat</li>
                                <li><i class="fas fa-check"></i> PDF-Export</li>
                                <li><i class="fas fa-times"></i> Keine KI-Optimierung</li>
                            </ul>
                        </div>
                        <div class="plan-option selected" data-plan="profi" tabindex="0" role="button" aria-label="Profi-Plan auswählen">
                            <div class="popular-badge">Empfohlen</div>
                            <h4>Profi</h4>
                            <div class="plan-price">€9<span>/Monat</span></div>
                            <ul>
                                <li><i class="fas fa-check"></i> Unbegrenzte Angebote</li>
                                <li><i class="fas fa-check"></i> Premium-Vorlagen</li>
                                <li><i class="fas fa-check"></i> Vollständige KI-Optimierung</li>
                            </ul>
                        </div>
                        <div class="plan-option" data-plan="unternehmen" tabindex="0" role="button" aria-label="Unternehmens-Plan auswählen">
                            <h4>Unternehmen</h4>
                            <div class="plan-price">€29<span>/Monat</span></div>
                            <ul>
                                <li><i class="fas fa-check"></i> Team-Zugänge</li>
                                <li><i class="fas fa-check"></i> Erweiterte KI-Funktionen</li>
                                <li><i class="fas fa-check"></i> Prioritäts-Support</li>
                            </ul>
                        </div>
                    </div>
                    <button class="btn btn-primary next-step">Weiter zur Zahlung</button>
                </div>

                <!-- Schritt 2: Zahlungsinformationen -->
                <div class="subscription-step" id="step2">
                    <h3>Zahlungsinformationen</h3>
                    <div class="payment-methods">
                        <div class="payment-method active" data-method="creditcard" tabindex="0" role="button" aria-label="Kreditkarte als Zahlungsmethode auswählen">
                            <i class="fab fa-cc-visa"></i>
                            <i class="fab fa-cc-mastercard"></i>
                            <i class="fab fa-cc-amex"></i>
                            Kreditkarte
                        </div>
                        <div class="payment-method" data-method="paypal" tabindex="0" role="button" aria-label="PayPal als Zahlungsmethode auswählen">
                            <i class="fab fa-paypal"></i>
                            PayPal
                        </div>
                        <div class="payment-method" data-method="sepa" tabindex="0" role="button" aria-label="SEPA-Lastschrift als Zahlungsmethode auswählen">
                            <i class="fas fa-bank"></i>
                            SEPA-Lastschrift
                        </div>
                    </div>

                    <div class="payment-details" id="creditcardDetails">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cardNumber">Kartennummer</label>
                                <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" aria-label="Kartennummer eingeben">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cardExpiry">Ablaufdatum</label>
                                <input type="text" id="cardExpiry" placeholder="MM/JJ" aria-label="Ablaufdatum der Karte eingeben">
                            </div>
                            <div class="form-group">
                                <label for="cardCvc">Sicherheitscode</label>
                                <input type="text" id="cardCvc" placeholder="CVC" aria-label="Sicherheitscode der Karte eingeben">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="cardName">Name auf der Karte</label>
                            <input type="text" id="cardName" aria-label="Name auf der Karte eingeben">
                        </div>
                    </div>

                    <div class="payment-details" id="paypalDetails" style="display:none;">
                        <p>Sie werden nach Bestätigung zu PayPal weitergeleitet</p>
                    </div>

                    <div class="payment-details" id="sepaDetails" style="display:none;">
                        <div class="form-group">
                            <label for="iban">IBAN</label>
                            <input type="text" id="iban" placeholder="DE00 1234 5678 9012 3456 78" aria-label="IBAN eingeben">
                        </div>
                        <div class="form-group">
                            <label for="accountName">Kontoinhaber</label>
                            <input type="text" id="accountName" aria-label="Name des Kontoinhabers eingeben">
                        </div>
                    </div>

                    <div class="form-group">
                        <input type="checkbox" id="termsAgree" aria-label="AGB und Widerrufsbelehrung akzeptieren">
                        <label for="termsAgree">Ich akzeptiere die <a href="#">AGB</a> und <a href="#">Widerrufsbelehrung</a></label>
                    </div>

                    <div class="step-actions">
                        <button class="btn btn-secondary prev-step">Zurück</button>
                        <button class="btn btn-primary" id="completePayment">
                            <i class="fas fa-lock"></i> Zahlung abschließen (€9/Monat)
                        </button>
                    </div>
                </div>

                <!-- Schritt 3: Bestätigung -->
                <div class="subscription-step" id="step3" style="text-align: center;">
                    <div style="font-size: 48px; color: var(--success); margin: 20px 0;">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3>Vielen Dank für Ihr Abonnement!</h3>
                    <p>Ihr Profi-Abo wurde erfolgrelich aktiviert.</p>
                    <div class="subscription-summary">
                        <p><strong>Plan:</strong> Profi (€9/Monat)</p>
                        <p><strong>Nächste Zahlung:</strong> 01.09.2023</p>
                        <p><strong>Rechnung wurde an: </strong> email@example.com gesendet</p>
                    </div>
                    <button class="btn btn-primary close-subscription-modal">Zurück zur Anwendung</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Account Section -->
    <section class="account-section" id="account" style="display: none;">
        <div class="app-card">
            <div class="card-header">
                <div class="card-title">
                    <div class="card-icon">
                        <i class="fas fa-user"></i>
                    </div>
                    Mein Konto
                </div>
                <div>
                    <button class="btn btn-secondary" id="accountSettingsBtn">
                        <i class="fas fa-cog"></i> Einstellungen
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="account-info">
                    <h3>Willkommen, <span id="userName">Max Mustermann</span></h3>
                    <p>Mitglied seit: <span id="joinDate">01.01.2023</span></p>
                    
                    <div class="subscription-status">
                        <h4>Ihr Abonnement</h4>
                        <p><strong>Status:</strong> <span class="status-active">Aktiv</span></p>
                        <p><strong>Plan:</strong> Profi</p>
                        <p><strong>Nächste Zahlung:</strong> 01.10.2023</p>
                        <button class="btn btn-secondary" id="manageSubscription">
                            <i class="fas fa-cog"></i> Abonnement verwalten
                        </button>
                    </div>
                    
                    <div class="account-actions" style="margin-top: 30px;">
                        <button class="btn btn-secondary" id="documentsBtn">
                            <i class="fas fa-file-alt"></i> Meine Dokumente
                        </button>
                        <button class="btn btn-secondary" id="teamBtn">
                            <i class="fas fa-users"></i> Team verwalten
                        </button>
                        <button class="btn btn-secondary" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Abmelden
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Documents Section -->
    <section class="documents-section" id="documents" style="display: none;">
        <div class="app-card">
            <div class="card-header">
                <div class="card-title">
                    <div class="card-icon">
                        <i class="fas fa-folder-open"></i>
                    </div>
                    Meine Dokumente
                </div>
                <div>
                    <button class="btn btn-secondary" id="refreshDocsBtn">
                        <i class="fas fa-sync-alt"></i> Aktualisieren
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="documents-list" id="documentsList">
                    <div class="empty-preview">
                        <i class="fas fa-folder-open empty-icon"></i>
                        <h3 class="empty-title">Keine Dokumente gefunden</h3>
                        <p class="empty-text">Ihre erstellten Angebote und Entwürfe werden hier angezeigt.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Team Section -->
    <section class="team-section" id="team" style="display: none;">
        <div class="app-card">
            <div class="card-header">
                <div class="card-title">
                    <div class="card-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    Team-Mitglieder
                </div>
                <div>
                    <button class="btn btn-primary" id="inviteMemberBtn">
                        <i class="fas fa-user-plus"></i> Einladen
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="team-list" id="teamList">
                    <div class="empty-preview">
                        <i class="fas fa-users empty-icon"></i>
                        <h3 class="empty-title">Keine Team-Mitglieder</h3>
                        <p class="empty-text">Laden Sie Kollegen ein, um gemeinsam an Angeboten zu arbeiten.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Hero Section -->
        <section class="hero-section">
            <div class="hero-text">
                <h1 class="hero-title">Professionelle Angebote <span>in Minuten</span> erstellen</h1>
                <p class="hero-subtitle">KI-generierte Angebote für Handwerker, Freelancer und Selbstständige. Sparen Sie Zeit und überzeugen Sie Ihre Kunden.</p>
                
                <div class="form-actions">
                    <button class="btn btn-primary" style="padding: 14px 28px; font-size: 16px;" id="heroGenerateBtn">
                        <i class="fas fa-bolt"></i> Jetzt Angebot erstellen
                    </button>
                    <button class="btn btn-secondary" style="padding: 14px 28px; font-size: 16px;" id="learnMoreBtn">
                        <i class="fas fa-info-circle"></i> Mehr erfahren
                    </button>
                </div>
            </div>
            
            <div class="hero-image">
                <div style="width: 100%; height: 400px; background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%); border-radius: var(--border-radius); display: flex; align-items: center; justify-content: center; box-shadow: 0 20px 40px rgba(67, 97, 238, 0.2);">
                    <div style="text-align: center; color: white; padding: 20px;">
                        <i class="fas fa-file-invoice" style="font-size: 80px; margin-bottom: 20px;"></i>
                        <h2 style="font-size: 28px; margin-bottom: 15px;">KI-Angebotsgenerator</h2>
                        <p style="font-size: 18px;">Schnell, einfach und professionell</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section class="features-section" id="features" style="margin-bottom: 60px;">
            <h2 style="text-align: center; font-size: 32px; margin-bottom: 40px; color: var(--dark);">Unsere Funktionen</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px;">
                <div style="background: white; padding: 30px; border-radius: var(--border-radius); box-shadow: var(--card-shadow);">
                    <div style="width: 60px; height: 60px; background: rgba(67, 97, 238, 0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; color: var(--primary); font-size: 24px;">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h3 style="font-size: 20px; margin-bottom: 15px; color: var(--dark);">KI-optimierte Texte</h3>
                    <p style="color: var(--gray);">Unsere KI formuliert professionelle Angebotstexte basierend auf Ihren Eingaben, angepasst an Ihre Branche.</p>
                </div>
                
                <div style="background: white; padding: 30px; border-radius: var(--border-radius); box-shadow: var(--card-shadow);">
                    <div style="width: 60px; height: 60px; background: rgba(67, 97, 238, 0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; color: var(--primary); font-size: 24px;">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <h3 style="font-size: 20px; margin-bottom: 15px; color: var(--dark);">PDF-Export</h3>
                    <p style="color: var(--gray);">Exportieren Sie Ihr Angebot als hochwertiges PDF mit einem Klick, bereit zum Versand an Ihre Kunden.</p>
                </div>
                
                <div style="background: white; padding: 30px; border-radius: var(--border-radius); box-shadow: var(--card-shadow);">
                    <div style="width: 60px; height: 60px; background: rgba(67, 97, 238, 0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; color: var(--primary); font-size: 24px;">
                        <i class="fas fa-save"></i>
                    </div>
                    <h3 style="font-size: 20px; margin-bottom: 15px; color: var(--dark);">Automatisches Speichern</h3>
                    <p style="color: var(--gray);">Ihre Entwürfe werden automatisch gespeichert, sodass Sie später weiterarbeiten können.</p>
                </div>
            </div>
        </section>

        <!-- Pricing Section -->
        <section class="pricing-section" id="pricing" style="margin-bottom: 60px;">
            <h2 style="text-align: center; font-size: 32px; margin-bottom: 40px; color: var(--dark);">Preise</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; max-width: 1000px; margin: 0 auto;">
                <div style="background: white; padding: 30px; border-radius: var(--border-radius); box-shadow: var(--card-shadow); text-align: center; border: 2px solid var(--primary);">
                    <h3 style="font-size: 24px; margin-bottom: 15px; color: var(--primary);">Basis</h3>
                    <div style="font-size: 40px; font-weight: 700; margin-bottom: 20px; color: var(--dark);">€0<span style="font-size: 16px; color: var(--gray);">/Monat</span></div>
                    <ul style="text-align: left; margin-bottom: 30px; list-style: none;">
                        <li style="padding: 8px 0; border-bottom: 1px solid #e2e8f0;"><i class="fas fa-check" style="color: var(--success); margin-right: 10px;"></i> 5 Angebote/Monat</li>
                        <li style="padding: 8px 0; border-bottom: 1px solid #e2e8f0;"><i class="fas fa-check" style="color: var(--success); margin-right: 10px;"></i> PDF-Export</li>
                        <li style="padding: 8px 0; border-bottom: 1px solid #e2e8f0;"><i class="fas fa-check" style="color: var(--success); margin-right: 10px;"></i> Basis-Vorlagen</li>
                        <li style="padding: 8px 0;"><i class="fas fa-times" style="color: var(--gray); margin-right: 10px;"></i> <span style="color: var(--gray);">Keine KI-Optimierung</span></li>
                    </ul>
                    <button class="btn btn-primary subscribe-btn" data-plan="basis">
                        <i class="fas fa-credit-card"></i> Jetzt abonnieren
                    </button>
                </div>
                
                <div style="background: white; padding: 30px; border-radius: var(--border-radius); box-shadow: var(--card-shadow); text-align: center; border: 2px solid var(--accent); position: relative;">
                    <div style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: var(--accent); color: var(--dark); padding: 5px 15px; border-radius: 20px; font-weight: 600; font-size: 14px;">Empfohlen</div>
                    <h3 style="font-size: 24px; margin-bottom: 15px; color: var(--primary);">Profi</h3>
                    <div style="font-size: 40px; font-weight: 700; margin-bottom: 20px; color: var(--dark);">€9<span style="font-size: 16px; color: var(--gray);">/Monat</span></div>
                    <ul style="text-align: left; margin-bottom: 30px; list-style: none;">
                        <li style="padding: 8px 0; border-bottom: 1px solid #e2e8f0;"><i class="fas fa-check" style="color: var(--success); margin-right: 10px;"></i> Unbegrenzte Angebote</li>
                        <li style="padding: 8px 0; border-bottom: 1px solid #e2e8f0;"><i class="fas fa-check" style="color: var(--success); margin-right: 10px;"></i> PDF-Export</li>
                        <li style="padding: 8px 0; border-bottom: 1px solid #e2e8f0;"><i class="fas fa-check" style="color: var(--success); margin-right: 10px;"></i> Premium-Vorlagen</li>
                        <li style="padding: 8px 0;"><i class="fas fa-check" style="color: var(--success); margin-right: 10px;"></i> KI-Optimierung</li>
                    </ul>
                    <button class="btn btn-primary subscribe-btn" data-plan="profi">
                        <i class="fas fa-credit-card"></i> Jetzt abonnieren
                    </button>
                </div>
                
                <div style="background: white; padding: 30px; border-radius: var(--border-radius); box-shadow: var(--card-shadow); text-align: center; border: 2px solid var(--primary);">
                    <h3 style="font-size: 24px; margin-bottom: 15px; color: var(--primary);">Unternehmen</h3>
                    <div style="font-size: 40px; font-weight: 700; margin-bottom: 20px; color: var(--dark);">€29<span style="font-size: 16px; color: var(--gray);">/Monat</span></div>
                    <ul style="text-align: left; margin-bottom: 30px; list-style: none;">
                        <li style="padding: 8px 0; border-bottom: 1px solid #e2e8f0;"><i class="fas fa-check" style="color: var(--success); margin-right: 10px;"></i> Unbegrenzte Angebote</li>
                        <li style="padding: 8px 0; border-bottom: 1px solid #e2e8f0;"><i class="fas fa-check" style="color: var(--success); margin-right: 10px;"></i> PDF-Export</li>
                        <li style="padding: 8px 0; border-bottom: 1px solid #e2e8f0;"><i class="fas fa-check" style="color: var(--success); margin-right: 10px;"></i> Premium-Vorlagen</li>
                        <li style="padding: 8px 0;"><i class="fas fa-check" style="color: var(--success); margin-right: 10px;"></i> Erweiterte KI-Optimierung</li>
                    </ul>
                    <button class="btn btn-primary subscribe-btn" data-plan="unternehmen">
                        <i class="fas fa-credit-card"></i> Jetzt abonnieren
                    </button>
                </div>
            </div>
        </section>

        <!-- App Container -->
        <section class="app-container">
            <!-- Form Panel -->
            <div class="app-card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">
                            <i class="fas fa-edit"></i>
                        </div>
                        Angebot erstellen
                    </div>
                    <div>
                        <button class="btn btn-secondary" id="resetBtn">
                            <i class="fas fa-redo"></i> Zurücksetzen
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <form id="offerForm" class="form-section">
                        <div class="form-group">
                            <label for="businessName" class="required">Ihr Firmenname</label>
                            <input type="text" id="businessName" name="businessName" required 
                                   placeholder="z.B. Malerbetrieb Schmidt GmbH" aria-required="true">
                            <div class="error-message" id="businessNameError">Bitte geben Sie einen Firmennamen ein</div>
                        </div>

                        <div class="form-group">
                            <label for="businessAddress">Ihre Firmenadresse</label>
                            <textarea id="businessAddress" name="businessAddress" 
                                      placeholder="Firmenstraße 123&#10;12345 Stadt&#10;Tel: 0123/456789" aria-label="Firmenadresse eingeben"></textarea>
                            <div class="input-hint">Wird im Angebot als Absender angezeigt</div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="businessType">Branche</label>
                                <select id="businessType" name="businessType" aria-label="Branche auswählen">
                                    <option value="handwerk">Handwerk</option>
                                    <option value="maler">Maler/Lackierer</option>
                                    <option value="elektriker">Elektriker</option>
                                    <option value="it">IT/Webdesign</option>
                                    <option value="beratung">Beratung/Coaching</option>
                                    <option value="fotografie">Fotografie</option>
                                    <option value="reinigung">Reinigung</option>
                                    <option value="garten">Garten/Landschaft</option>
                                    <option value="sonstiges">Sonstiges</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="offerDate">Angebotsdatum</label>
                                <input type="date" id="offerDate" name="offerDate" aria-label="Angebotsdatum auswählen">
                            </div>
                        </div>
                        
                        <!-- Custom Branch Input -->
                        <div class="form-group custom-branch" id="customBranchContainer">
                            <label for="customBranch" class="required">Bitte Branche angeben</label>
                            <input type="text" id="customBranch" name="customBranch" 
                                   placeholder="z.B. Eventmanagement, Tierpflege..." aria-required="true">
                            <div class="error-message" id="customBranchError">Bitte geben Sie Ihre Branche an</div>
                        </div>

                        <div class="form-group">
                            <label for="customerName" class="required">Kundenname</label>
                            <input type="text" id="customerName" name="customerName" required 
                                   placeholder="Max Mustermann" aria-required="true">
                            <div class="error-message" id="customerNameError">Bitte geben Sie einen Kundennamen ein</div>
                        </div>

                        <div class="form-group">
                            <label for="customerAddress">Kundenadresse</label>
                            <textarea id="customerAddress" name="customerAddress" 
                                      placeholder="Musterstraße 123&#10;12345 Musterstadt" aria-label="Kundenadresse eingeben"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="serviceDescription" class="required">Leistungsbeschreibung</label>
                            <textarea id="serviceDescription" name="serviceDescription" required
                                      placeholder="z.B. Streichen von 40m² Wandfläche, 2 Anstriche, inkl. Material" aria-required="true"></textarea>
                            <div class="error-message" id="serviceDescriptionError">Bitte beschreiben Sie die Leistung</div>
                            <div class="input-hint">Beschreiben Sie kurz, was Sie anbieten. Die KI erstellt daraus professionelle Formulierungen.</div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="totalPrice" class="required">Gesamtpreis (€)</label>
                                <input type="number" id="totalPrice" name="totalPrice" required 
                                       step="0.01" placeholder="480.00" min="0" aria-required="true">
                                <div class="error-message" id="totalPriceError">Bitte geben Sie einen gültigen Preis ein</div>
                            </div>
                            <div class="form-group">
                                <label for="vatRate">MwSt. (%)</label>
                                <input type="number" id="vatRate" name="vatRate" step="0.1" 
                                       placeholder="19" value="19" min="0" max="100" aria-label="Mehrwertsteuersatz eingeben">
                                <div class="error-message" id="vatRateError">Bitte geben Sie einen gültigen MwSt.-Satz ein (0-100%)</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="deliveryTime">Ausführungszeitraum</label>
                            <input type="text" id="deliveryTime" name="deliveryTime" 
                                   placeholder="z.B. KW 32/2025 oder nach Vereinbarung" aria-label="Ausführungszeitraum eingeben">
                        </div>

                        <div class="form-group">
                            <label for="paymentTerms">Zahlungsbedingungen</label>
                            <select id="paymentTerms" name="paymentTerms" aria-label="Zahlungsbedingungen auswählen">
                                <option value="sofort">Zahlung bei Auftragserteilung</option>
                                <option value="abnahme">Zahlung bei Abnahme</option>
                                <option value="14tage">Zahlung innerhalb 14 Tagen</option>
                                <option value="30tage">Zahlung innerhalb 30 Tagen</option>
                                <option value="anzahlung">50% Anzahlung, Rest bei Fertigstellung</option>
                            </select>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" id="generateBtn" style="flex: 1; padding: 16px;">
                                <i class="fas fa-robot"></i> Angebot erstellen
                            </button>
                            <button type="button" class="btn btn-secondary" id="saveDraftBtn" style="flex: 1; padding: 16px;">
                                <i class="fas fa-save"></i> Entwurf speichern
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Preview Panel -->
            <div class="app-card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-icon">
                            <i class="fas fa-eye"></i>
                        </div>
                        Angebotsvorschau
                    </div>
                    <div>
                        <button class="btn btn-secondary" id="downloadBtn">
                            <i class="fas fa-download"></i> PDF
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="preview-container" id="previewContainer">
                        <div class="loading" id="loading">
                            <div class="loader"></div>
                            <div class="loading-text">KI generiert Ihr Angebot...</div>
                        </div>
                        <div id="previewContent">
                            <div class="empty-preview">
                                <i class="fas fa-file-alt empty-icon"></i>
                                <h3 class="empty-title">Ihr Angebot erscheint hier</h3>
                                <p class="empty-text">Füllen Sie das Formular aus und klicken Sie auf "Angebot erstellen", um eine professionelle Angebotsvorlage zu generieren.</p>
                                <button class="btn btn-secondary" id="demoBtn">
                                    <i class="fas fa-magic"></i> Demo anzeigen
                                </button>
                                <button class="btn btn-secondary" id="loadDraftBtn" style="margin-top: 15px;">
                                    <i class="fas fa-folder-open"></i> Entwurf laden
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Impressum Section -->
        <section class="legal-page" id="impressum">
            <h1>Impressum</h1>
            
            <h2>Angaben gemäß § 5 TMG:</h2>
            <p>Offertly GmbH<br>
            Musterstraße 123<br>
            12345 Musterstadt</p>
            
            <h2>Vertreten durch:</h2>
            <p>Geschäftsführer: Max Mustermann</p>
            
            <h2>Kontakt:</h2>
            <p>Telefon: +49 (0) 123 456789<br>
            E-Mail: info@offertly.example.com</p>
            
            <h2>Registereintrag:</h2>
            <p>Eintragung im Handelsregister.<br>
            Registergericht: Amtsgericht Musterstadt<br>
            Registernummer: HRB 12345</p>
            
            <h2>Umsatzsteuer-ID:</h2>
            <p>Umsatzsteuer-Identifikationsnummer gemäß §27a Umsatzsteuergesetz:<br>
            DE123456789</p>
            
            <h2>Verantwortlich für den Inhalt nach § 55 Abs. 2 RStV:</h2>
            <p>Max Mustermann<br>
            Musterstraße 123<br>
            12345 Musterstadt</p>
        </section>

        <!-- Datenschutz Section (hidden by default) -->
        <section class="legal-page" id="datenschutz" style="display: none;">
            <h1>Datenschutzerklärung</h1>
            
            <h2>1. Datenschutz auf einen Blick</h2>
            <h3>Allgemeine Hinweise</h3>
            <p>Die folgenden Hinweise geben einen einfachen Überblick darüber, was mit Ihren personenbezogenen Daten passiert, wenn Sie unsere Website besuchen.</p>
            
            <h3>Datenerfassung auf unserer Website</h3>
            <p>Die Datenverarbeitung auf dieser Website erfolgt durch den Websitebetreiber. Dessen Kontaktdaten können Sie dem Impressum dieser Website entnehmen.</p>
        </section>

        <!-- AGB Section (hidden by default) -->
        <section class="legal-page" id="agb" style="display: none;">
            <h1>Allgemeine Geschäftsbedingungen (AGB)</h1>
            
            <h2>1. Geltungsbereich</h2>
            <p>Diese Allgemeinen Geschäftsbedingungen gelten für alle Verträge, die zwischen der Offertly GmbH und dem Kunden geschlossen werden.</p>
        </section>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <i class="fas fa-check-circle" id="toastIcon"></i>
        <span id="toastMessage">Vorgang erfolgreich abgeschlossen</span>
    </div>

    <!-- Zoom Controls (hidden by default) -->
    <div class="zoom-controls" id="zoomControls" style="display: none;">
        <button class="zoom-btn" id="zoomIn" aria-label="Vergrößern"><i class="fas fa-search-plus"></i></button>
        <button class="zoom-btn" id="zoomOut" aria-label="Verkleinern"><i class="fas fa-search-minus"></i></button>
        <button class="zoom-btn" id="zoomReset" aria-label="Originalgröße"><i class="fas fa-expand"></i></button>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <div>
                <div class="footer-logo">
                    <i class="fas fa-file-invoice-dollar"></i>
                    Offertly
                </div>
                <p class="footer-text">
                    Professionelle Angebote in Minuten erstellen mit künstlicher Intelligenz. 
                    Speziell entwickelt für Handwerker, Freelancer und Selbstständige.
                </p>
            </div>
            
            <div>
                <h3 class="footer-heading">Rechtliches</h3>
                <div class="footer-links">
                    <a href="#impressum" class="footer-link">Impressum</a>
                    <a href="javascript:showLegalPage('datenschutz')" class="footer-link">Datenschutzerklärung</a>
                    <a href="javascript:showLegalPage('agb')" class="footer-link">AGB</a>
                </div>
            </div>
            
            <div>
                <h3 class="footer-heading">Kontakt</h3>
                <div class="footer-links">
                    <a href="mailto:info@example.com" class="footer-link">info@example.com</a>
                    <a href="tel:+49123456789" class="footer-link">+49 123 456789</a>
                    <div style="margin-top: 15px;">
                        <a href="#" style="color: #a0aec0; margin-right: 15px; font-size: 18px;"><i class="fab fa-facebook"></i></a>
                        <a href="#" style="color: #a0aec0; margin-right: 15px; font-size: 18px;"><i class="fab fa-twitter"></i></a>
                        <a href="#" style="color: #a0aec0; font-size: 18px;"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="copyright">
            &copy; 2023 Offertly GmbH. Alle Rechte vorbehalten.
        </div>
    </footer>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker registration successful');
                }).catch(err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>

    <script>
        // Firebase-Konfiguration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "offertly.firebaseapp.com",
            projectId: "offertly-prod",
            storageBucket: "offertly.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcd1234"
        };

        // Firebase Initialisierung
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // Firestore Offline Persistence aktivieren
        db.enablePersistence()
          .catch((err) => {
              if (err.code == 'failed-precondition') {
                  console.log("Offline-Persistence ist nur in einem Tab gleichzeitig möglich");
              } else if (err.code == 'unimplemented') {
                  console.log("Der Browser unterstützt keine Offline-Persistence");
              }
          });

        // Globale Variablen
        let currentUser = null;
        let currentOfferData = null;
        let savedDrafts = [];
        const { jsPDF } = window.jspdf;
        
        // DOM-Elemente
        const offerForm = document.getElementById('offerForm');
        const generateBtn = document.getElementById('generateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const demoBtn = document.getElementById('demoBtn');
        const heroGenerateBtn = document.getElementById('heroGenerateBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const previewContainer = document.getElementById('previewContainer');
        const previewContent = document.getElementById('previewContent');
        const loading = document.getElementById('loading');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        const toastIcon = document.getElementById('toastIcon');
        const businessTypeSelect = document.getElementById('businessType');
        const customBranchContainer = document.getElementById('customBranchContainer');
        const customBranchInput = document.getElementById('customBranch');
        const saveDraftBtn = document.getElementById('saveDraftBtn');
        const loadDraftBtn = document.getElementById('loadDraftBtn');
        const themeToggle = document.getElementById('themeToggle');
        const mobileThemeToggle = document.getElementById('mobileThemeToggle');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileCloseBtn = document.getElementById('mobileCloseBtn');
        const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
        const mobileNav = document.getElementById('mobileNav');
        const learnMoreBtn = document.getElementById('learnMoreBtn');
        const loginBtn = document.getElementById('loginBtn');
        const registerBtn = document.getElementById('registerBtn');
        const loginModal = document.getElementById('loginModal');
        const registerModal = document.getElementById('registerModal');
        const closeModalButtons = document.querySelectorAll('.close-modal');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const forgotPasswordLink = document.getElementById('forgotPassword');
        const subscriptionModal = document.getElementById('subscriptionModal');
        const subscribeButtons = document.querySelectorAll('.subscribe-btn');
        const closeSubscriptionModal = document.querySelector('.close-subscription-modal');
        const planOptions = document.querySelectorAll('.plan-option');
        const paymentMethods = document.querySelectorAll('.payment-method');
        const nextStepBtn = document.querySelector('.next-step');
        const prevStepBtn = document.querySelector('.prev-step');
        const completePaymentBtn = document.getElementById('completePayment');
        const accountSection = document.getElementById('account');
        const documentsSection = document.getElementById('documents');
        const teamSection = document.getElementById('team');
        const logoutBtn = document.getElementById('logoutBtn');
        const manageSubscriptionBtn = document.getElementById('manageSubscription');
        const documentsBtn = document.getElementById('documentsBtn');
        const teamBtn = document.getElementById('teamBtn');
        const refreshDocsBtn = document.getElementById('refreshDocsBtn');
        const inviteMemberBtn = document.getElementById('inviteMemberBtn');
        const accountSettingsBtn = document.getElementById('accountSettingsBtn');
        const accountModal = document.getElementById('accountModal');
        const accountForm = document.getElementById('accountForm');
        const verifyEmailBtn = document.getElementById('verifyEmailBtn');
        const userNameElement = document.getElementById('userName');
        const joinDateElement = document.getElementById('joinDate');
        const documentsList = document.getElementById('documentsList');
        const teamList = document.getElementById('teamList');
        const cookieBanner = document.getElementById('cookie-banner');
        const acceptCookiesBtn = document.getElementById('accept-cookies');
        const rejectCookiesBtn = document.getElementById('reject-cookies');
        const zoomControls = document.getElementById('zoomControls');
        const zoomInBtn = document.getElementById('zoomIn');
        const zoomOutBtn = document.getElementById('zoomOut');
        const zoomResetBtn = document.getElementById('zoomReset');
        const pwaInstall = document.getElementById('pwaInstall');
        const pwaClose = document.getElementById('pwaClose');
        const offlineNotification = document.getElementById('offlineNotification');
        const feedbackBtn = document.getElementById('feedbackBtn');
        const feedbackModal = document.getElementById('feedbackModal');
        const cancelFeedback = document.getElementById('cancelFeedback');
        const submitFeedback = document.getElementById('submitFeedback');
        const analyticsOptOut = document.getElementById('analyticsOptOut');
        const disableAnalytics = document.getElementById('disableAnalytics');
        const keepAnalytics = document.getElementById('keepAnalytics');
        const langBtns = document.querySelectorAll('.lang-btn');
        
        let currentPlan = 'profi';
        let currentStep = 1;
        let currentZoom = 1;
        let deferredPrompt = null;

        // Initialisierung
        function init() {
            // Aktuelles Datum setzen
            document.getElementById('offerDate').valueAsDate = new Date();
            
            // Cookie Banner anzeigen wenn nicht akzeptiert
            if (!localStorage.getItem('cookieConsent')) {
                cookieBanner.style.display = 'block';
            }
            
            // Offline-Status überwachen
            updateOnlineStatus();
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            
            // Event-Listener
            offerForm.addEventListener('submit', generateOffer);
            resetBtn.addEventListener('click', resetForm);
            demoBtn.addEventListener('click', loadDemoData);
            heroGenerateBtn.addEventListener('click', scrollToForm);
            learnMoreBtn.addEventListener('click', scrollToFeatures);
            downloadBtn.addEventListener('click', generatePDF);
            saveDraftBtn.addEventListener('click', saveDraft);
            loadDraftBtn.addEventListener('click', loadDraft);
            
            // Branchen-Änderung Event-Listener
            businessTypeSelect.addEventListener('change', toggleCustomBranch);
            
            // Theme Toggle
            themeToggle.addEventListener('click', toggleTheme);
            mobileThemeToggle.addEventListener('click', toggleTheme);
            
            // Mobile Navigation
            mobileMenuBtn.addEventListener('click', openMobileMenu);
            mobileCloseBtn.addEventListener('click', closeMobileMenu);
            mobileMenuOverlay.addEventListener('click', closeMobileMenu);
            
            // Auth Event-Listener
            loginBtn.addEventListener('click', () => loginModal.style.display = 'block');
            registerBtn.addEventListener('click', () => registerModal.style.display = 'block');
            document.getElementById('mobileLoginBtn').addEventListener('click', () => {
                closeMobileMenu();
                loginModal.style.display = 'block';
            });
            
            closeModalButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    loginModal.style.display = 'none';
                    registerModal.style.display = 'none';
                    subscriptionModal.style.display = 'none';
                    accountModal.style.display = 'none';
                });
            });
            
            window.addEventListener('click', (e) => {
                if (e.target === loginModal) loginModal.style.display = 'none';
                if (e.target === registerModal) registerModal.style.display = 'none';
                if (e.target === subscriptionModal) subscriptionModal.style.display = 'none';
                if (e.target === accountModal) accountModal.style.display = 'none';
            });
            
            // Login Formular
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                // Validierung
                if (!validateEmail(email)) {
                    showFormError('loginEmailError', 'Bitte geben Sie eine gültige E-Mail-Adresse ein');
                    return;
                }
                
                if (!password) {
                    showFormError('loginPasswordError', 'Bitte geben Sie Ihr Passwort ein');
                    return;
                }
                
                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        currentUser = userCredential.user;
                        showToast('Erfolgreich angemeldet!');
                        loginModal.style.display = 'none';
                        updateAuthUI(true);
                        loadUserData();
                    })
                    .catch((error) => {
                        showToast(error.message, 'error');
                        if (error.code === 'auth/user-not-found') {
                            showFormError('loginEmailError', 'Kein Konto mit dieser E-Mail gefunden');
                        } else if (error.code === 'auth/wrong-password') {
                            showFormError('loginPasswordError', 'Falsches Passwort');
                        }
                    });
            });
            
            // Registrierungsformular
            registerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('regName').value;
                const email = document.getElementById('regEmail').value;
                const password = document.getElementById('regPassword').value;
                const confirmPassword = document.getElementById('regConfirmPassword').value;
                
                // Validierung
                if (!name) {
                    showFormError('regNameError', 'Bitte geben Sie Ihren Namen ein');
                    return;
                }
                
                if (!validateEmail(email)) {
                    showFormError('regEmailError', 'Bitte geben Sie eine gültige E-Mail-Adresse ein');
                    return;
                }
                
                if (password.length < 8) {
                    showFormError('regPasswordError', 'Das Passwort muss mindestens 8 Zeichen lang sein');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showFormError('regConfirmPasswordError', 'Passwörter stimmen nicht überein');
                    return;
                }
                
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        currentUser = userCredential.user;
                        
                        // Benutzerdaten in Firestore speichern
                        return db.collection('users').doc(userCredential.user.uid).set({
                            name: name,
                            email: email,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            subscription: 'free'
                        });
                    })
                    .then(() => {
                        showToast('Konto erfolgreich erstellt!');
                        registerModal.style.display = 'none';
                        updateAuthUI(true);
                        loadUserData();
                    })
                    .catch((error) => {
                        showToast(error.message, 'error');
                        if (error.code === 'auth/email-already-in-use') {
                            showFormError('regEmailError', 'Diese E-Mail ist bereits registriert');
                        } else if (error.code === 'auth/weak-password') {
                            showFormError('regPasswordError', 'Das Passwort ist zu schwach');
                        }
                    });
            });
            
            // Passwort vergessen
            forgotPasswordLink.addEventListener('click', (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                
                if (!email) {
                    showToast('Bitte geben Sie Ihre E-Mail ein', 'error');
                    return;
                }
                
                auth.sendPasswordResetEmail(email)
                    .then(() => {
                        showToast('Passwort-Reset-Link wurde an Ihre E-Mail gesendet');
                        loginModal.style.display = 'none';
                    })
                    .catch((error) => {
                        showToast(error.message, 'error');
                    });
            });
            
            // Abo Event-Listener
            subscribeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    if (!currentUser) {
                        showToast('Bitte melden Sie sich zuerst an', 'error');
                        loginModal.style.display = 'block';
                        return;
                    }
                    
                    currentPlan = btn.dataset.plan;
                    subscriptionModal.style.display = 'block';
                    showStep(1);
                });
            });
            
            closeSubscriptionModal.addEventListener('click', () => {
                subscriptionModal.style.display = 'none';
            });
            
            // Planauswahl
            planOptions.forEach(option => {
                option.addEventListener('click', () => {
                    planOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    currentPlan = option.dataset.plan;
                    updatePaymentButton();
                });
                
                // Tastatur-Navigation für Planauswahl
                option.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        planOptions.forEach(opt => opt.classList.remove('selected'));
                        option.classList.add('selected');
                        currentPlan = option.dataset.plan;
                        updatePaymentButton();
                    }
                });
            });
            
            // Zahlungsmethoden
            paymentMethods.forEach(method => {
                method.addEventListener('click', () => {
                    paymentMethods.forEach(m => m.classList.remove('active'));
                    method.classList.add('active');
                    
                    // Zahlungsdetails anzeigen
                    document.querySelectorAll('.payment-details').forEach(d => d.style.display = 'none');
                    document.getElementById(`${method.dataset.method}Details`).style.display = 'block';
                });
                
                // Tastatur-Navigation für Zahlungsmethoden
                method.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        paymentMethods.forEach(m => m.classList.remove('active'));
                        method.classList.add('active');
                        document.querySelectorAll('.payment-details').forEach(d => d.style.display = 'none');
                        document.getElementById(`${method.dataset.method}Details`).style.display = 'block';
                    }
                });
            });
            
            // Schritte navigieren
            nextStepBtn.addEventListener('click', () => showStep(2));
            prevStepBtn.addEventListener('click', () => showStep(1));
            
            // Zahlung abschließen
            completePaymentBtn.addEventListener('click', (e) => {
                e.preventDefault();
                
                if (!document.getElementById('termsAgree').checked) {
                    showToast('Bitte akzeptieren Sie die AGB', 'error');
                    return;
                }
                
                // Hier würde die echte Zahlungsabwicklung stehen
                console.log('Payment processed for plan:', currentPlan);
                
                // Simulierte erfolgreiche Zahlung
                simulatePayment();
            });
            
            // Logout
            logoutBtn.addEventListener('click', () => {
                auth.signOut().then(() => {
                    currentUser = null;
                    updateAuthUI(false);
                    accountSection.style.display = 'none';
                    documentsSection.style.display = 'none';
                    teamSection.style.display = 'none';
                    showToast('Erfolgreich abgemeldet');
                });
            });
            
            // Abonnement verwalten
            manageSubscriptionBtn.addEventListener('click', () => {
                subscriptionModal.style.display = 'block';
                showStep(1);
            });
            
            // Dokumente anzeigen
            documentsBtn.addEventListener('click', () => {
                accountSection.style.display = 'none';
                documentsSection.style.display = 'block';
                teamSection.style.display = 'none';
                loadDocuments();
            });
            
            // Team anzeigen
            teamBtn.addEventListener('click', () => {
                accountSection.style.display = 'none';
                documentsSection.style.display = 'none';
                teamSection.style.display = 'block';
                loadTeamMembers();
            });
            
            // Account Einstellungen
            accountSettingsBtn.addEventListener('click', () => {
                accountModal.style.display = 'block';
                // Formular mit aktuellen Daten füllen
                document.getElementById('accountName').value = userNameElement.textContent;
                document.getElementById('accountEmail').value = currentUser.email;
            });
            
            // Account Formular
            accountForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const newName = document.getElementById('accountName').value;
                const newEmail = document.getElementById('accountEmail').value;
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                // Name aktualisieren
                if (newName !== userNameElement.textContent) {
                    db.collection('users').doc(currentUser.uid).update({
                        name: newName
                    }).then(() => {
                        userNameElement.textContent = newName;
                        showToast('Name erfolgreich aktualisiert');
                    });
                }
                
                // E-Mail aktualisieren
                if (newEmail !== currentUser.email) {
                    currentUser.updateEmail(newEmail).then(() => {
                        db.collection('users').doc(currentUser.uid).update({
                            email: newEmail
                        }).then(() => {
                            showToast('E-Mail erfolgreich aktualisiert');
                        });
                    }).catch(error => {
                        showToast('Fehler beim Aktualisieren der E-Mail: ' + error.message, 'error');
                    });
                }
                
                // Passwort aktualisieren
                if (newPassword && newPassword === confirmPassword) {
                    currentUser.updatePassword(newPassword).then(() => {
                        showToast('Passwort erfolgreich aktualisiert');
                    }).catch(error => {
                        showToast('Fehler beim Aktualisieren des Passworts: ' + error.message, 'error');
                    });
                } else if (newPassword !== confirmPassword) {
                    showToast('Passwörter stimmen nicht überein', 'error');
                }
                
                accountModal.style.display = 'none';
            });
            
            // E-Mail Verifizierung
            verifyEmailBtn.addEventListener('click', () => {
                currentUser.sendEmailVerification().then(() => {
                    showToast('Verifizierungs-E-Mail wurde gesendet');
                }).catch(error => {
                    showToast('Fehler beim Senden der Verifizierungs-E-Mail: ' + error.message, 'error');
                });
            });
            
            // Dokumente aktualisieren
            refreshDocsBtn.addEventListener('click', loadDocuments);
            
            // Team-Mitglied einladen
            inviteMemberBtn.addEventListener('click', () => {
                const email = prompt('Geben Sie die E-Mail-Adresse des Teammitglieds ein:');
                if (email) {
                    db.collection('users').doc(currentUser.uid).collection('team').add({
                        email: email,
                        status: 'pending',
                        invitedAt: firebase.firestore.FieldValue.serverTimestamp()
                    }).then(() => {
                        showToast('Einladung wurde versendet');
                        loadTeamMembers();
                    }).catch(error => {
                        showToast('Fehler beim Einladen: ' + error.message, 'error');
                    });
                }
            });
            
            // Cookie Banner
            acceptCookiesBtn.addEventListener('click', () => {
                localStorage.setItem('cookieConsent', 'true');
                cookieBanner.style.display = 'none';
                // Google Analytics aktivieren
                gtag('consent', 'update', {
                    'analytics_storage': 'granted'
                });
            });
            
            rejectCookiesBtn.addEventListener('click', () => {
                localStorage.setItem('cookieConsent', 'false');
                cookieBanner.style.display = 'none';
                // Google Analytics deaktivieren
                gtag('consent', 'update', {
                    'analytics_storage': 'denied'
                });
            });
            
            // Zoom Controls
            zoomInBtn.addEventListener('click', () => {
                currentZoom += 0.1;
                previewContent.style.transform = `scale(${currentZoom})`;
                previewContent.style.transformOrigin = 'top left';
            });
            
            zoomOutBtn.addEventListener('click', () => {
                if (currentZoom > 0.5) {
                    currentZoom -= 0.1;
                    previewContent.style.transform = `scale(${currentZoom})`;
                    previewContent.style.transformOrigin = 'top left';
                }
            });
            
            zoomResetBtn.addEventListener('click', () => {
                currentZoom = 1;
                previewContent.style.transform = 'scale(1)';
            });
            
            // PWA Install Prompt
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                pwaInstall.classList.add('show');
            });
            
            pwaInstall.addEventListener('click', () => {
                pwaInstall.classList.remove('show');
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    } else {
                        console.log('User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                });
            });
            
            pwaClose.addEventListener('click', (e) => {
                e.stopPropagation();
                pwaInstall.classList.remove('show');
            });
            
            // Feedback Button
            feedbackBtn.addEventListener('click', toggleFeedbackModal);
            cancelFeedback.addEventListener('click', toggleFeedbackModal);
            submitFeedback.addEventListener('click', submitFeedbackForm);
            
            // Analytics Opt-out
            disableAnalytics.addEventListener('click', () => {
                localStorage.setItem('analyticsDisabled', 'true');
                analyticsOptOut.style.display = 'none';
                // Google Analytics deaktivieren
                gtag('consent', 'update', {
                    'analytics_storage': 'denied'
                });
            });
            
            keepAnalytics.addEventListener('click', () => {
                localStorage.setItem('analyticsDisabled', 'false');
                analyticsOptOut.style.display = 'none';
            });
            
            // Sprache umschalten
            langBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    langBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    // Hier würde die Sprachumschaltung implementiert werden
                    showToast('Sprache geändert');
                });
            });
            
            // Lade gespeicherte Entwürfe
            loadSavedDrafts();
            
            // Initialisiere Formularvalidierung
            initFormValidation();
            
            // Setze Dark Mode wenn bevorzugt
            if (localStorage.getItem('darkMode') === 'enabled' || 
                (!localStorage.getItem('darkMode') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.body.classList.add('dark-mode');
                updateThemeIcons(true);
            }
            
            // Auth State Observer
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    updateAuthUI(true);
                    loadUserData();
                } else {
                    currentUser = null;
                    updateAuthUI(false);
                }
            });
            
            // Zeige Analytics-Opt-out nach 5 Sekunden, wenn nicht bereits entschieden
            setTimeout(() => {
                if (!localStorage.getItem('analyticsDisabled') && !localStorage.getItem('cookieConsent')) {
                    analyticsOptOut.classList.add('show');
                }
            }, 5000);
        }
        
        // Online/Offline Status aktualisieren
        function updateOnlineStatus() {
            if (navigator.onLine) {
                offlineNotification.classList.remove('show');
            } else {
                offlineNotification.classList.add('show');
            }
        }
        
        // Feedback Modal anzeigen/verstecken
        function toggleFeedbackModal() {
            feedbackModal.classList.toggle('show');
        }
        
        // Feedback absenden
        function submitFeedbackForm() {
            const feedbackText = document.querySelector('.feedback-textarea').value;
            if (!feedbackText) {
                showToast('Bitte geben Sie Feedback ein', 'error');
                return;
            }
            
            // Hier würde das Feedback an den Server gesendet werden
            console.log('Feedback received:', feedbackText);
            showToast('Vielen Dank für Ihr Feedback!');
            toggleFeedbackModal();
            document.querySelector('.feedback-textarea').value = '';
        }
        
        // E-Mail validieren
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        // Formularfehler anzeigen
        function showFormError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.add('visible');
        }
        
        // Benutzerdaten laden
        function loadUserData() {
            if (!currentUser) return;
            
            db.collection('users').doc(currentUser.uid).get()
                .then((doc) => {
                    if (doc.exists) {
                        const userData = doc.data();
                        userNameElement.textContent = userData.name;
                        joinDateElement.textContent = new Date(userData.createdAt.toDate()).toLocaleDateString('de-DE');
                        accountSection.style.display = 'block';
                        
                        // Beispiel: Firmennamen aus Benutzerdaten vorausfüllen
                        if (userData.companyName) {
                            document.getElementById('businessName').value = userData.companyName;
                        }
                        
                        // Abo-Status anzeigen
                        updateSubscriptionUI(userData.subscription || 'free');
                    }
                })
                .catch((error) => {
                    console.error("Error loading user data:", error);
                });
        }
        
        // Dokumente laden
        function loadDocuments() {
            if (!currentUser) return;
            
            documentsList.innerHTML = '<div class="loading"><div class="loader"></div><div class="loading-text">Lade Dokumente...</div></div>';
            
            db.collection('users').doc(currentUser.uid).collection('offers')
                .orderBy('createdAt', 'desc')
                .limit(10)
                .get()
                .then((querySnapshot) => {
                    if (querySnapshot.empty) {
                        documentsList.innerHTML = `
                            <div class="empty-preview">
                                <i class="fas fa-folder-open empty-icon"></i>
                                <h3 class="empty-title">Keine Dokumente gefunden</h3>
                                <p class="empty-text">Sie haben noch keine Angebote erstellt.</p>
                            </div>
                        `;
                        return;
                    }
                    
                    let html = '';
                    querySnapshot.forEach(doc => {
                        const data = doc.data();
                        const version = data.version || '1.0';
                        const hasComments = data.comments && data.comments.length > 0;
                        
                        html += `
                            <div class="document-card">
                                <div class="document-title">Angebot ${data.offerNumber} <span class="version-badge">v${version}</span></div>
                                <div class="document-meta">Erstellt am ${data.createdAt.toDate().toLocaleDateString('de-DE')}</div>
                                ${hasComments ? '<div class="comment-bubble" title="Kommentare"><i class="fas fa-comment"></i></div>' : ''}
                                <div class="document-actions">
                                    <button class="btn btn-secondary" onclick="viewDocument('${doc.id}')">
                                        <i class="fas fa-eye"></i> Ansehen
                                    </button>
                                    <button class="btn btn-secondary" onclick="downloadDocument('${doc.id}')">
                                        <i class="fas fa-download"></i> PDF
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    
                    documentsList.innerHTML = html;
                })
                .catch(error => {
                    console.error("Error loading documents:", error);
                    documentsList.innerHTML = `
                        <div class="empty-preview">
                            <i class="fas fa-exclamation-triangle empty-icon"></i>
                            <h3 class="empty-title">Fehler beim Laden</h3>
                            <p class="empty-text">Die Dokumente konnten nicht geladen werden.</p>
                        </div>
                    `;
                });
        }
        
        // Team-Mitglieder laden
        function loadTeamMembers() {
            if (!currentUser) return;
            
            teamList.innerHTML = '<div class="loading"><div class="loader"></div><div class="loading-text">Lade Team-Mitglieder...</div></div>';
            
            db.collection('users').doc(currentUser.uid).collection('team')
                .orderBy('invitedAt', 'desc')
                .get()
                .then((querySnapshot) => {
                    if (querySnapshot.empty) {
                        teamList.innerHTML = `
                            <div class="empty-preview">
                                <i class="fas fa-users empty-icon"></i>
                                <h3 class="empty-title">Keine Team-Mitglieder</h3>
                                <p class="empty-text">Laden Sie Kollegen ein, um gemeinsam an Angeboten zu arbeiten.</p>
                            </div>
                        `;
                        return;
                    }
                    
                    let html = '';
                    querySnapshot.forEach(doc => {
                        const member = doc.data();
                        const initials = member.email.split('@')[0].substring(0, 2).toUpperCase();
                        html += `
                            <div class="team-member">
                                <div class="member-avatar">${initials}</div>
                                <div class="member-info">
                                    <div class="member-name">${member.email}</div>
                                    <div class="member-email">${member.email}</div>
                                </div>
                                <div class="member-status ${member.status}">${member.status === 'active' ? 'Aktiv' : 'Ausstehend'}</div>
                            </div>
                        `;
                    });
                    
                    teamList.innerHTML = html;
                })
                .catch(error => {
                    console.error("Error loading team members:", error);
                    teamList.innerHTML = `
                        <div class="empty-preview">
                            <i class="fas fa-exclamation-triangle empty-icon"></i>
                            <h3 class="empty-title">Fehler beim Laden</h3>
                            <p class="empty-text">Die Team-Mitglieder konnten nicht geladen werden.</p>
                        </div>
                    `;
                });
        }
        
        // Scroll zu Formular
        function scrollToForm() {
            document.querySelector('.app-container').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Scroll zu Features
        function scrollToFeatures() {
            document.getElementById('features').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Mobile Menu öffnen
        function openMobileMenu() {
            mobileNav.classList.add('show');
            mobileMenuOverlay.classList.add('show');
            document.body.style.overflow = 'hidden';
        }
        
        // Mobile Menu schließen
        function closeMobileMenu() {
            mobileNav.classList.remove('show');
            mobileMenuOverlay.classList.remove('show');
            document.body.style.overflow = '';
        }
        
        // Theme umschalten
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            
            if (isDarkMode) {
                localStorage.setItem('darkMode', 'enabled');
            } else {
                localStorage.setItem('darkMode', 'disabled');
            }
            
            updateThemeIcons(isDarkMode);
        }
        
        // Theme Icons aktualisieren
        function updateThemeIcons(isDarkMode) {
            const icon = isDarkMode ? 'fa-sun' : 'fa-moon';
            themeToggle.innerHTML = `<i class="fas ${icon}"></i>`;
            mobileThemeToggle.innerHTML = `<i class="fas ${icon}"></i> ${isDarkMode ? 'Light' : 'Dark'} Mode`;
        }
        
        // Rechtsseiten anzeigen
        function showLegalPage(pageId) {
            // Alle Legal Pages verstecken
            document.querySelectorAll('.legal-page').forEach(page => {
                page.style.display = 'none';
            });
            
            // Gewünschte Seite anzeigen
            document.getElementById(pageId).style.display = 'block';
            
            // Zur Seite scrollen
            document.getElementById(pageId).scrollIntoView({ behavior: 'smooth' });
            
            // Mobile Menu schließen falls offen
            closeMobileMenu();
        }
        
        // Formularvalidierung initialisieren
        function initFormValidation() {
            const requiredFields = [
                { id: 'businessName', errorId: 'businessNameError' },
                { id: 'customerName', errorId: 'customerNameError' },
                { id: 'serviceDescription', errorId: 'serviceDescriptionError' },
                { id: 'totalPrice', errorId: 'totalPriceError' },
                { id: 'vatRate', errorId: 'vatRateError' }
            ];
            
            requiredFields.forEach(field => {
                const input = document.getElementById(field.id);
                const error = document.getElementById(field.errorId);
                
                input.addEventListener('input', () => {
                    validateField(input, error);
                });
            });
        }
        
        // Feld validieren
        function validateField(input, errorElement) {
            if (input.required && !input.value.trim()) {
                input.parentElement.classList.add('has-error');
                return false;
            }
            
            if (input.type === 'number') {
                const value = parseFloat(input.value);
                const min = parseFloat(input.min) || -Infinity;
                const max = parseFloat(input.max) || Infinity;
                
                if (isNaN(value) || value < min || value > max) {
                    input.parentElement.classList.add('has-error');
                    return false;
                }
            }
            
            if (input.type === 'email' && input.value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input.value)) {
                input.parentElement.classList.add('has-error');
                errorElement.textContent = 'Bitte geben Sie eine gültige E-Mail-Adresse ein';
                return false;
            }
            
            input.parentElement.classList.remove('has-error');
            return true;
        }
        
        // Formular validieren
        function validateForm() {
            let isValid = true;
            
            // Erforderliche Felder validieren
            const requiredFields = [
                { id: 'businessName', errorId: 'businessNameError', message: 'Bitte geben Sie einen Firmennamen ein' },
                { id: 'customerName', errorId: 'customerNameError', message: 'Bitte geben Sie einen Kundennamen ein' },
                { id: 'serviceDescription', errorId: 'serviceDescriptionError', message: 'Bitte beschreiben Sie die Leistung' },
                { id: 'totalPrice', errorId: 'totalPriceError', message: 'Bitte geben Sie einen gültigen Preis ein' }
            ];
            
            requiredFields.forEach(field => {
                const input = document.getElementById(field.id);
                const error = document.getElementById(field.errorId);
                
                if (!validateField(input, error)) {
                    error.textContent = field.message;
                    isValid = false;
                }
            });
            
            // MwSt validieren
            const vatInput = document.getElementById('vatRate');
            const vatError = document.getElementById('vatRateError');
            const vatValue = parseFloat(vatInput.value);
            
            if (isNaN(vatValue) || vatValue < 0 || vatValue > 100) {
                vatInput.parentElement.classList.add('has-error');
                vatError.textContent = 'Bitte geben Sie einen gültigen MwSt-Satz ein (0-100%)';
                isValid = false;
            } else {
                vatInput.parentElement.classList.remove('has-error');
            }
            
            // Benutzerdefinierte Branche validieren
            if (businessTypeSelect.value === 'sonstiges' && !customBranchInput.value.trim()) {
                customBranchContainer.classList.add('has-error');
                document.getElementById('customBranchError').textContent = 'Bitte geben Sie Ihre Branche an';
                isValid = false;
            } else {
                customBranchContainer.classList.remove('has-error');
            }
            
            return isValid;
        }
        
        // Branchen-Eingabe anzeigen/verstecken
        function toggleCustomBranch() {
            if (businessTypeSelect.value === 'sonstiges') {
                customBranchContainer.classList.add('show');
                customBranchInput.required = true;
            } else {
                customBranchContainer.classList.remove('show');
                customBranchInput.required = false;
            }
        }
        
        // Toast anzeigen
        function showToast(message, type = 'success') {
            toastMessage.textContent = message;
            
            // Icon und Farbe basierend auf Typ setzen
            if (type === 'error') {
                toast.className = 'toast error show';
                toastIcon.className = 'fas fa-exclamation-circle';
            } else if (type === 'success') {
                toast.className = 'toast success show';
                toastIcon.className = 'fas fa-check-circle';
            } else {
                toast.className = 'toast show';
                toastIcon.className = 'fas fa-info-circle';
            }
            
            // Nach 3 Sekunden ausblenden
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // Formular zurücksetzen
        function resetForm() {
            offerForm.reset();
            document.getElementById('offerDate').valueAsDate = new Date();
            document.getElementById('vatRate').value = "19";
            previewContent.innerHTML = `
                <div class="empty-preview">
                    <i class="fas fa-file-alt empty-icon"></i>
                    <h3 class="empty-title">Ihr Angebot erscheint hier</h3>
                    <p class="empty-text">Füllen Sie das Formular aus und klicken Sie auf "Angebot erstellen", um eine professionelle Angebotsvorlage zu generieren.</p>
                    <button class="btn btn-secondary" id="demoBtn">
                        <i class="fas fa-magic"></i> Demo anzeigen
                    </button>
                    <button class="btn btn-secondary" id="loadDraftBtn" style="margin-top: 15px;">
                        <i class="fas fa-folder-open"></i> Entwurf laden
                    </button>
                </div>
            `;
            // Event-Listener für Demo-Button neu setzen
            document.getElementById('demoBtn').addEventListener('click', loadDemoData);
            document.getElementById('loadDraftBtn').addEventListener('click', loadDraft);
            toggleCustomBranch(); // Zurücksetzen der Branchen-Anzeige
            showToast('Formular zurückgesetzt');
        }
        
        // Angebotsnummer generieren
        function generateOfferNumber() {
            const year = new Date().getFullYear();
            const month = String(new Date().getMonth() + 1).padStart(2, '0');
            const day = String(new Date().getDate()).padStart(2, '0');
            const random = Math.floor(Math.random() * 999) + 1;
            return `${year}${month}${day}-${random.toString().padStart(3, '0')}`;
        }
        
        // KI-Textgenerierung
        async function generateOfferText(data) {
            // Fallback für Offline-Modus oder wenn API nicht verfügbar
            if (!navigator.onLine) {
                return generateFallbackText(data);
            }

            try {
                // Hier würde Ihre echte API-Integration stehen
                // Mock Response für Demo-Zwecke
                const mockResponse = {
                    greeting: `Sehr geehrte/r ${data.customerName.split(' ')[0]},`,
                    intro: 'vielen Dank für Ihre Anfrage. Basierend auf Ihren Angaben können wir Ihnen folgendes Angebot unterbreiten:',
                    services: data.serviceDescription.split('\n').filter(line => line.trim()),
                    closing: 'Für Rückfragen stehen wir Ihnen gerne zur Verfügung.'
                };
                
                // Simulierte Verzögerung
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                return mockResponse;
            } catch (error) {
                console.error("KI Error:", error);
                return generateFallbackText(data);
            }
        }
        
        function generateFallbackText(data) {
            return {
                greeting: `Sehr geehrte/r ${data.customerName.split(' ')[0]},`,
                intro: 'vielen Dank für Ihre Anfrage. Gerne unterbreiten wir Ihnen unser Angebot:',
                services: data.serviceDescription.split('\n').filter(line => line.trim()),
                closing: 'Wir freuen uns auf Ihre Rückmeldung.'
            };
        }
        
        // Zahlungsbedingungen-Text
        function getPaymentTermsText(paymentTerms) {
            const terms = {
                'sofort': 'Zahlung bei Auftragserteilung',
                'abnahme': 'Zahlung bei Abnahme der Leistung',
                '14tage': 'Zahlung innerhalb von 14 Tagen nach Rechnungsstellung',
                '30tage': 'Zahlung innerhalb von 30 Tagen nach Rechnungsstellung',
                'anzahlung': '50% Anzahlung bei Auftragserteilung, Restzahlung bei Fertigstellung'
            };
            return terms[paymentTerms] || terms['abnahme'];
        }
        
        // Demo-Daten laden
        function loadDemoData() {
            const demoData = {
                businessName: 'Malerbetrieb Schmidt GmbH',
                businessAddress: 'Handwerkerstraße 45\n12345 Musterstadt\nTel: 0123/456789\ninfo@maler-schmidt.de',
                businessType: 'maler',
                customerName: 'Familie Müller',
                customerAddress: 'Eichenstraße 123\n54321 Beispielstadt',
                serviceDescription: 'Streichen von ca. 45 m² Wandfläche im Wohnzimmer und Flur mit hochwertiger Dispersionsfarbe, inklusive Abkleben, Abdecken, Grundierung und zwei Anstriche. Verwendung von schadstoffarmer Innenfarbe.',
                totalPrice: '650.00',
                vatRate: '19',
                deliveryTime: 'KW 35/2025 (nach Absprache)',
                paymentTerms: 'abnahme'
            };

            // Formular mit Demo-Daten füllen
            Object.keys(demoData).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = demoData[key];
                }
            });

            // Branchen-Anzeige aktualisieren
            toggleCustomBranch();
            
            // Angebot generieren
            generateOffer({ preventDefault: () => {} });
            
            showToast('Demo-Daten geladen');
        }
        
        // Gespeicherte Entwürfe laden
        function loadSavedDrafts() {
            const drafts = localStorage.getItem('offertlyDrafts');
            if (drafts) {
                savedDrafts = JSON.parse(drafts);
            }
        }
        
        // Entwurf speichern
        function saveDraft() {
            if (!validateForm()) {
                showToast('Bitte korrigieren Sie die Fehler im Formular', 'error');
                return;
            }
            
            const formData = new FormData(offerForm);
            const data = Object.fromEntries(formData.entries());
            
            // Entwurfsdatum hinzufügen
            data.draftDate = new Date().toISOString();
            
            // Entwurf speichern
            savedDrafts.push(data);
            localStorage.setItem('offertlyDrafts', JSON.stringify(savedDrafts));
            
            // In Firestore speichern, wenn eingeloggt
            if (currentUser) {
                db.collection('users').doc(currentUser.uid).collection('drafts').add({
                    data: data,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                })
                .then(() => {
                    showToast('Entwurf erfolgreich gespeichert');
                })
                .catch((error) => {
                    console.error("Error saving draft:", error);
                    showToast('Fehler beim Speichern des Entwurfs', 'error');
                });
            } else {
                showToast('Entwurf lokal gespeichert');
            }
        }
        
        // Entwurf laden
        function loadDraft() {
            if (currentUser) {
                // Entwürfe aus Firestore laden
                db.collection('users').doc(currentUser.uid).collection('drafts')
                    .orderBy('createdAt', 'desc')
                    .limit(1)
                    .get()
                    .then((querySnapshot) => {
                        if (!querySnapshot.empty) {
                            const draftData = querySnapshot.docs[0].data().data;
                            fillFormWithDraft(draftData);
                            showToast('Entwurf erfolgreich geladen');
                        } else {
                            showToast('Keine gespeicherten Entwürfe gefunden', 'error');
                        }
                    })
                    .catch((error) => {
                        console.error("Error loading draft:", error);
                        showToast('Fehler beim Laden des Entwurfs', 'error');
                    });
            } else if (savedDrafts.length > 0) {
                // Neuesten lokalen Entwurf laden
                const latestDraft = savedDrafts[savedDrafts.length - 1];
                fillFormWithDraft(latestDraft);
                showToast('Entwurf erfolgreich geladen');
            } else {
                showToast('Keine gespeicherten Entwürfe gefunden', 'error');
            }
        }
        
        // Formular mit Entwurfsdaten füllen
        function fillFormWithDraft(draftData) {
            Object.keys(draftData).forEach(key => {
                if (key !== 'draftDate') {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = draftData[key];
                    }
                }
            });
            
            // Branchen-Anzeige aktualisieren
            toggleCustomBranch();
        }
        
        // Angebot generieren
        async function generateOffer(e) {
            e.preventDefault();
            
            if (!validateForm()) {
                showToast('Bitte korrigieren Sie die Fehler im Formular', 'error');
                return;
            }
            
            const formData = new FormData(offerForm);
            const data = Object.fromEntries(formData.entries());
            
            // Wenn "Sonstiges" ausgewählt ist, benutzerdefinierte Branche hinzufügen
            if (data.businessType === 'sonstiges') {
                data.businessType = data.customBranch || 'sonstiges';
            }
            
            // Loading anzeigen
            loading.classList.add('show');
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Wird erstellt...';
            
            try {
                const offerNumber = generateOfferNumber();
                const aiText = await generateOfferText(data);
                
                // Preisberechnung
                const netPrice = parseFloat(data.totalPrice);
                const vatRate = parseFloat(data.vatRate);
                const vatAmount = netPrice * (vatRate / 100);
                const grossPrice = netPrice + vatAmount;
                
                // Angebots-HTML erstellen
                const offerHTML = `
                    <div class="offer-header">
                        <div class="company-info">
                            <div class="company-name">${data.businessName}</div>
                            <div class="company-address">${data.businessAddress.replace(/\n/g, '<br>')}</div>
                        </div>
                        <div class="offer-meta">
                            <div class="offer-number">Angebot Nr.: ${offerNumber}</div>
                            <div class="offer-date">Datum: ${new Date(data.offerDate).toLocaleDateString('de-DE')}</div>
                        </div>
                    </div>
                    
                    <div class="customer-info">
                        <div class="customer-title">Kunde:</div>
                        ${data.customerName}<br>
                        ${data.customerAddress.replace(/\n/g, '<br>')}
                    </div>
                    
                    <div class="offer-content">
                        <div class="offer-greeting">
                            <p>${aiText.greeting}</p>
                            <br>
                            <p>${aiText.intro}</p>
                        </div>
                        
                        <div class="service-description">
                            <strong>Leistungsbeschreibung:</strong><br><br>
                            ${data.serviceDescription.replace(/\n/g, '<br>')}
                            
                            <div style="margin-top: 15px;">
                                <strong>Inkludierte Leistungen:</strong>
                                <ul style="margin-top: 8px; padding-left: 20px;">
                                    ${aiText.services.map(service => `<li>${service}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                        
                        <div class="price-section">
                            <div class="price-row">
                                <span>Nettopreis:</span>
                                <span>${netPrice.toFixed(2)} €</span>
                            </div>
                            
                            ${vatRate > 0 ? `
                                <div class="price-row">
                                    <span>zzgl. ${vatRate}% MwSt.:</span>
                                    <span>${vatAmount.toFixed(2)} €</span>
                                </div>
                                <div class="price-row price-total">
                                    <span>Gesamtpreis:</span>
                                    <span>${grossPrice.toFixed(2)} €</span>
                                </div>
                            ` : `
                                <div class="price-row price-total">
                                    <span>Gesamtpreis:</span>
                                    <span>${netPrice.toFixed(2)} € (inkl. USt. gem. §19 UStG)</span>
                                </div>
                            `}
                        </div>
                        
                        <div style="margin-top: 25px;">
                            <strong>Zahlungsbedingungen:</strong><br>
                            ${getPaymentTermsText(data.paymentTerms)}
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <strong>Ausführungszeitraum:</strong><br>
                            ${data.deliveryTime || 'Nach Vereinbarung'}
                        </div>
                        
                        <br>
                        <p>${aiText.closing}</p>
                        <br>
                        <p>Mit freundlichen Grüßen</p>
                        <p style="margin-top: 10px;"><strong>${data.businessName}</strong></p>
                        
                        <div class="signature-line">
                            Unterschrift / Stempel
                        </div>
                    </div>
                    
                    <div class="terms-section">
                        <strong>Hinweise:</strong><br>
                        • Dieses Angebot ist 30 Tage ab Ausstellungsdatum gültig<br>
                        • Alle Preise verstehen sich zuzüglich der gesetzlichen Mehrwertsteuer, sofern nicht anders angegeben<br>
                        • Änderungen und Zusatzleistungen werden gesondert berechnet<br>
                        • Es gelten unsere Allgemeinen Geschäftsbedingungen
                    </div>
                `;
                
                previewContent.innerHTML = offerHTML;
                zoomControls.style.display = 'flex';
                
                // Daten für PDF speichern
                currentOfferData = {
                    html: offerHTML,
                    data: data,
                    offerNumber: offerNumber,
                    netPrice: netPrice,
                    vatAmount: vatAmount,
                    grossPrice: grossPrice
                };
                
                // In Firestore speichern, wenn eingeloggt
                if (currentUser) {
                    db.collection('users').doc(currentUser.uid).collection('offers').add({
                        offerNumber: offerNumber,
                        data: data,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        html: offerHTML,
                        version: '1.0'
                    })
                    .then(() => {
                        console.log("Offer saved to Firestore");
                    })
                    .catch((error) => {
                        console.error("Error saving offer:", error);
                    });
                }
                
                showToast('Angebot erfolgreich generiert!');
            } catch (error) {
                console.error("Error generating offer:", error);
                showToast('Fehler beim Generieren des Angebots', 'error');
            } finally {
                // Loading ausblenden
                loading.classList.remove('show');
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="fas fa-robot"></i> Angebot erstellen';
            }
        }
        
        // PDF generieren
        function generatePDF(template = 'default') {
            if (!currentOfferData) {
                showToast('Bitte erstellen Sie zuerst ein Angebot', 'error');
                return;
            }
            
            downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Wird erstellt...';
            downloadBtn.disabled = true;
            
            // Erstelle ein temporäres Element für html2canvas
            const tempDiv = document.createElement('div');
            tempDiv.style.width = '794px'; // A4 width in pixels (210mm)
            tempDiv.style.padding = '40px';
            tempDiv.style.background = 'white';
            tempDiv.style.fontFamily = 'Georgia, serif';
            tempDiv.innerHTML = currentOfferData.html;
            
            // Füge es dem Dokument hinzu (unsichtbar)
            tempDiv.style.position = 'absolute';
            tempDiv.style.left = '-9999px';
            document.body.appendChild(tempDiv);
            
            // Erstelle das PDF nach einer kurzen Verzögerung
            setTimeout(() => {
                html2canvas(tempDiv, {
                    scale: 2,
                    useCORS: true,
                    logging: false
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jsPDF({
                        orientation: 'portrait',
                        unit: 'mm',
                        format: 'a4'
                    });
                    
                    const imgWidth = 210; // A4 width in mm
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    
                    pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                    
                    // Dateinamen generieren
                    const fileName = `Angebot_${currentOfferData.offerNumber}_${currentOfferData.data.customerName.replace(/\s+/g, '_')}.pdf`;
                    
                    // PDF speichern
                    pdf.save(fileName);
                    
                    // Temporäres Element entfernen
                    document.body.removeChild(tempDiv);
                    
                    downloadBtn.innerHTML = '<i class="fas fa-download"></i> PDF';
                    downloadBtn.disabled = false;
                    
                    showToast('PDF erfolgreich heruntergeladen!');
                    
                    // Analytics Event tracken
                    gtag('event', 'pdf_download', {
                        'event_category': 'engagement',
                        'event_label': currentOfferData.offerNumber
                    });
                }).catch(error => {
                    console.error('PDF Generation Error:', error);
                    showToast('Fehler beim Erstellen des PDFs', 'error');
                    downloadBtn.innerHTML = '<i class="fas fa-download"></i> PDF';
                    downloadBtn.disabled = false;
                });
            }, 500);
        }
        
        // Auth-UI aktualisieren
        function updateAuthUI(isLoggedIn) {
